---
title: "Minimum income and subjective poverty lines"
subtitle: "A comparison following a period of sluggish economic growth"
author: 
  - "Steven F. Koch^[Corresponding author: Department of Economics, University of Pretoria, Private Bag X20, Hatfield, South Africa; +27-12-420-5285; steve.koch@up.ac.za]"
  - "Bernice Macquela^[Department of Economics, University of Pretoria]"
thanks: The authors would like to thank someone for their comments and suggestions. Any remaining issues rest with the authors.
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  bookdown::pdf_document2: 
    latex_engine: xelatex
    dev: tikz
    keep_tex: true
    number_sections: true
    toc: false
  bookdown::gitbook: null
booktabs: yes
bibliography: 
    - refs.bib
    - bernice-refs.bib
header-includes:
    - \usepackage{setspace}\doublespacing
#    - \usepackage{draftwatermark}
    - \usepackage{dcolumn}
    - \usepackage{subfig}
    - \usepackage{threeparttablex}
    - \usepackage{longtable}
abstract: \singlespacing We use minimum income questions to examine subjective poverty in South Africa, comparing outcomes in 2014 to outcomes in 2023. 
---

<!--
    - \usepackage{draftwatermark}
\SetWatermarkText{Draft}
\AddToShipoutPictureFG{
  \AtPageCenter{% or \AtTextCenter
    \makebox[0pt]{\rotatebox[origin=c]{45}{%
      \scalebox{5}{\texttransparent{0.3}{Draft}}%
    }}
  }
}
-->

<!-- subject: JEL Classifications I15, J21
thanks: The authors would like to thank someone. 
csl: empirical-economics.csl 
-->

```{r global_options, include=FALSE, cache=FALSE}
knitr::opts_chunk$set(cache=TRUE,
                      echo=FALSE,
                      autodep=TRUE,
                      message=FALSE,
                      warning=FALSE,
                      #dev='tikz',
                      dev='png',
                      out.width='80%',
                      out.height='35%',
                      fig.align='center')

def.chunk.hook  <- knitr::knit_hooks$get("chunk")
knitr::knit_hooks$set(chunk = function(x, options) {
  x <- def.chunk.hook(x, options)
  ifelse(options$size != "normalsize", paste0("\\", options$size,"\n\n", x, "\n\n \\normalsize"), x)
})

knitr::opts_knit$set(kable.force.latex = TRUE)

library(tidyverse)
library(haven)
library(lubridate)
library(kableExtra)
library(np)  
library(quantreg)
library(nnet)
library(AER)
library(ivreg)
library(sandwich)
library(REndo)
library(qwraps2)
  options(qwraps2_markup = "latex")
library(stargazer)
library(MASS)
library(broom)

par(family = 'mono')

options(scipen = 999,
        np.messages=FALSE)

set.seed(42)
num.boot <- 1499 
num.splits <- 5000
q1 <- 0.025
q2 <- 0.975
nmulti <- 20

### Working Directory
#setwd('/Volumes/GoogleDrive/My Drive/Inequality/EqScalesFood')
```

```{r some-functions}
### Some useful functions ###

CM <- function(cm) {
  factor.values.eval <- colnames(cm)
  CM <- matrix(0,nrow(cm),nrow(cm))
  rownames(CM) <- rownames(cm)
  colnames(CM) <- rownames(cm)
  for(i in 1:ncol(cm)) CM[,(1:nrow(cm))[rownames(cm)==factor.values.eval[i]]] <- cm[,i]
  return(list(CM=CM,CCR=sum(diag(CM))/sum(CM)))
}

## this is a bit silly, but is driven by the difference in names between 
## prediction and model... Could also change the model data naming...
CM.logit <- function(cm) {
  factor.values.eval <- rownames(cm)
  CM <- matrix(0,nrow(cm),nrow(cm))
  rownames(CM) <- rownames(cm)
  colnames(CM) <- rownames(cm)
  for(i in 1:ncol(cm)) CM[,(1:nrow(cm))[rownames(cm)==factor.values.eval[i]]] <- cm[,i]
  return(list(CM=CM,CCR=sum(diag(CM))/sum(CM)))
}

stars <- function(x){
  case_when(x >=0 & x <= 0.005 ~ "$^a$", 
            x >=0 & x <= 0.01 ~ "$^b$",
            x >=0 & x <= 0.05 ~ "$^c$",
            x >=0 & x <= 0.1 ~ "$^d$",
            x>0.1 ~ "")
}

ctab <- function(sm, cluster = NULL) {
  # If cluster variable is provided, use cluster-robust SEs
  if (!is.null(cluster)) {
    Vcov <- vcovCL(sm, cluster = cluster)
  } else {
    Vcov <- vcovHC(sm, type = "HC1") # default robust SE
  }
  
  mm <- summary(sm, vcov = Vcov)
  modsum <- mm$coefficients
  
  n <- rownames(modsum)
  ses <- paste0("(", formatC(modsum[,2], format="f", digits=3, drop0trailing = FALSE), ")")
  z <- stars(modsum[,4])
  betas <- paste0(formatC(modsum[,1], format="f", digits=4, drop0trailing = FALSE), z)
  
  t1 <- tibble(n=n, b=betas, s=ses) %>%
    pivot_longer(!n, names_to="params", values_to="results")
  
  return(t1)
}

nlstab <- function(sm){
  modsum <- sm$parameters
  n <- rownames(modsum)
  CIs <- paste0("(",format(modsum[,1]-1.96*modsum[,2],digits=1,nsmall=2)," -- ",
                format(modsum[,1]+1.96*modsum[,2],digits=1,nsmall=2), ")")
  betas <- format(modsum[,1],digits=1,nsmall=4)
  t1 <- tibble(n=n,b=betas,s=CIs) %>%
    pivot_longer(!n,names_to="params",values_to = "results")
}

ivctab <- function(sm){
  mm <- summary(sm)
  modsum <- mm$coefficients
  n <- rownames(modsum)
  ses <- paste0("(",formatC(modsum[,2],format="f",digits=3, drop0trailing = F),")")
  z <- stars(modsum[,4])
  betas <- paste0(formatC(modsum[,1],format="f",digits=4, drop0trailing = F),z)
  t1 <- tibble(n=n,b=betas,s=ses) %>%
    pivot_longer(!n,names_to="params",values_to = "results")
  modnost <- sm$diagnostics
  nn <- rownames(modnost)
  degfree1 <- as.character(modnost[,1])
  z1 <- stars(modnost[,4])
  ivstat <- paste0(formatC(modnost[,3],format="f",digits=3, drop0trailing = F),z1)
  t2 <- tibble(n=nn,params=degfree1,results=ivstat)
  t <- rbind(t1,t2)
}

sptab <- function(sm){
  modsum <- sm
  n <- rownames(modsum)
  colnames(sm) <- c("betas","ses")
  tt <- sm[,1]/sm[,2]
  pp <- 2*pnorm(-abs(tt))
  n <- rownames(modsum)
  ses <- paste0("(",format(modsum[,2],digits=1,nsmall=3),")")
  z <- stars(pp)
  betas <- paste0(format(modsum[,1],digits=1,nsmall=4),z)
  t1 <- tibble(n=n,b=betas,s=ses) %>%
    pivot_longer(!n,names_to="params",values_to = "results")
}

estab <- function(sm){
  sm.all <- sm
  sm <- as.matrix(sm)
  n <- paste0(sm[,1]," ",sm[,2])
  ses <- paste0("(",formatC(as.numeric(sm[,4]),format="f",digits=0, drop0trailing = F),")")
  #z <- stars(sm[,4]) - not the right function, and not going to include.
  sm3.form <- formatC(as.numeric(sm[,3]),format="f",digits=0)
  #betas <- paste0(sm3.form,z)
  t1 <- tibble(n=n, b=sm3.form,s=ses) %>%
    pivot_longer(!n,names_to="result-type",values_to = "results") %>%
    separate(n, into =c("adults","kids"))
  estab.out <- t1[,c(1,2,4)]
}

only_perc <- function(x,
                   digits = getOption("qwraps2_frmt_digits", 2),
                   na_rm = FALSE,
                   show_denom = "ifNA",
                   show_symbol = TRUE,
                   markup = "latex") #getOption("qwraps2_markup", "latex")) 
                   {
  d <- sum(!is.na(x))
  n <- sum(x, na.rm = na_rm)
  p <- frmt(100*n/d, digits)

  if (show_denom == "never") {
    rtn <- paste0(p,"%")
  } else {
    if (show_denom =="always" | any(is.na(x))) {
      rtn <- paste0(frmt(as.integer(n)), "/", frmt(as.integer(d)), " (", p, "%)")
    } else {
      rtn <- paste0(p,"%")
    }
  }

  if (!show_symbol) {
    rtn <- gsub("%", "", rtn)
  }


  if (markup == "latex") {
    rtn <- gsub("%", "\\\\%", rtn)
  }

  return(rtn)
}

quadRoots <- function(a, b, c) {

print(paste0("You have chosen the quadratic equation ", a, "x^2 + ", b, "x + ", c, "."))

discriminant <- (b^2) - (4*a*c)

  if(discriminant < 0) {  # if discriminant is less than zero i.e no real roots
    return(paste0("This quadratic equation has no real numbered roots."))
  }
  else if(discriminant > 0) { # If discriminant is greater than 0 ie real roots
    x_int_plus <- (-b + sqrt(discriminant)) / (2*a)
    x_int_neg <- (-b - sqrt(discriminant)) / (2*a)

    return(paste0("The two x-intercepts for the quadratic equation are ",
                  format(round(x_int_plus, 5), nsmall = 5), " and ",
                  format(round(x_int_neg, 5), nsmall = 5), "."))
  }
  else #discriminant = 0  i.e only one root 
    x_int <- (-b) / (2*a)
    return(paste0("The quadratic equation has only one root. This root is ",
                  x_int))
}
```


```{r lcs}

# LCS data
person <- read_dta(file = "../lcsdata/lcs-2014-2015-persons-final-v1.dta")
household <- read_dta(file = "../lcsdata/lcs-2014-2015-households-v1.dta")

# hhsize, number of kids (age < 17) in each household to match ghs data
# Could probably pull this from household file, but already have the code
person1 <- person %>%
  dplyr::select(UQNO, Q14AGE, Q11710GRANTS) %>%
  group_by(UQNO) %>%
  summarise(hhsize = n(), # household size by appearance times of each ID
            kids = sum(Q14AGE <= 17), # number of child (age<17)
            adults = hhsize - kids,
            grants = sum(Q11710GRANTS == 1)
  ) %>%
  mutate(UQNO = as.character(UQNO))

person2 <- person %>%
  dplyr::select(UQNO, PERSONNO, Q12SEX, Q13POPGROUP, Q14AGE, Q17MARITAL, Q21HIGHLEVEL, 
         province_code, SETTLEMENT_TYPE) %>%
  filter(PERSONNO==1, 
         Q17MARITAL != 9,
         Q21HIGHLEVEL != 31,
         Q21HIGHLEVEL != 32,
         Q21HIGHLEVEL != 99) %>%  
  transmute(UQNO = as.character(UQNO),
            age = Q14AGE,
            hhh.dummy = ifelse(Q12SEX==1,1,0),
            hhh.male = as_factor(Q12SEX),
            ethnic = as_factor(Q13POPGROUP),
            province = as_factor(province_code),
            settle = factor(SETTLEMENT_TYPE, levels = c(1,2,4,5),
                            labels=c("Urban Formal","Urban Informal",
                                     "Traditional Area","Rural Formal")),
            marital = as_factor(Q17MARITAL),
            education = factor(Q21HIGHLEVEL, 
                               levels = c(98,1:25,27,28:29,26,30),
                               labels=c("none",rep("nqf0",9),"nqf1","nqf2",
                                        "nqf3",rep("nqf4",2),
                                       "nqf1","nqf2","nqf3",
                                       rep("nqf5",3), rep("nqf4",2),"nqf5",
                                       "nqf6",rep("nqf7",2),
                                       rep("nqf8",2),rep("nqf9-10",2))),
            Q21HIGHLEVEL) %>%
  droplevels() 

# household level variables
house.df <- household %>%
  dplyr::select(
    UQNO, income_inkind, expenditure_inkind, SURVEYDATE, Q229NETINCOME, 
    Q6105IMAGINE, Q116PRESENT, hholds_wgt, Q221AFOOD, Q221BHOUSING,
    Q221CCLOTHING, Q221DHEALTH) %>%
  filter(Q6105IMAGINE != 9, Q116PRESENT != 9, 
         Q221AFOOD != 9, Q221BHOUSING != 9,
         Q221CCLOTHING != 9,
         Q221DHEALTH != 9) %>% ## loses 790 obs.. before health
  transmute(
    UQNO = as.character(UQNO),
    psu = substr(UQNO,1,11),
    wt = hholds_wgt,
    surveydate = dmy(SURVEYDATE), # I just want to have separate months and years..
    month = as.factor(surveydate),
    #month = month(surveydate),
    surveyyear = year(surveydate),
    x = as.numeric(expenditure_inkind), 
    # the value of expenditures including in kind expenditure incurred by 
    # households for 12 months inflated/deflated to April 2015 using CPI
    x.month = x/12, #Monthly total expenditure
    y = as.numeric(income_inkind),  
    # 63 observations have 0 values... length(which(house.df$y==0))
    # also deflated/inflated to April 2015
    y.month = y/12,
    y2.month = y.month^2,
    lnx = log(x.month),
    lny = log(y.month),
    minq = Q229NETINCOME, 
    # 466 zero values (after dropping the 493 above) ... length(which(house.df$minq == 0))
    lnminq = log(minq),
  ) %>%
  filter(is.finite(lny),
         is.finite(lnx),
         is.finite(lnminq)) %>%  # Not sure this affects the final lcs data, though
  mutate(enough_inc = as.factor(lny >= lnminq)) %>%
  droplevels()
  


#merge above dataframes to get a dataframe LCS2014
lcs2014 <- person1 %>%
  full_join(person2, by="UQNO") %>%
  full_join(house.df, by="UQNO") %>%
  drop_na() %>%
  filter(adults > 0,
         adults <= 6,
         kids <= 4) %>%
  mutate(ao = ordered(adults),
         ko = ordered(kids),
         k0 = 1*(kids==0),
         k1 = 1*(kids==1),
         k2 = 1*(kids==2),
         k3 = 1*(kids==3),
         k4 = 1*(kids==4),
         a1 = 1*(adults==1),
         a2 = 1*(adults==2),
         a3 = 1*(adults==3),
         a4 = 1*(adults==4),
         a5 = 1*(adults==5),
         a6 = 1*(adults==6),
         lnx.sq = lnx^2,
         lny.sq = lny^2,
         age.sq = age^2) 
  #dplyr::select(-c(x.month,y.month,minq,Q21HIGHLEVEL,
  #                 surveydate, wt, hhh.dummy))

## It appears that we lose 312 observations for missing values, 
## we lose 556 in total; the extra coming from limiting adults and kids in hh
  
# save image
save(lcs2014, file = "../lcsdata/lcs2014-v2.Rdata")

# save a single data frame: LCS2014
# This gets used by the NP files.
#save(LCS2014, file="../lcsdata/LCS2014df.Rdata")

rm(person, household, house.df, person1, person2)

## Some parameters
LCSn <- nrow(lcs2014)
n2 <- 24
n1 <- LCSn-n2


```


```{r lcs-sub, dependson="lcs"}

# kids limited to max 4 and adults to max 6
dfref <- cbind(k1 = 0, k2 = 0, k3 = 0, k4 = 0, 
               a2 = 0, a3 = 0, a4 = 0, a5 = 0, a6 = 0)

akmat <- lcs2014 %>%
  dplyr::select(adults,kids,
                a1, a2, a3, a4, a5, a6, 
                k0, k1, k2, k3, k4) %>%
  unique() %>%
  arrange(kids) %>%
  group_by(kids) %>%
  arrange(adults) %>%
  ungroup()

dfalt <- akmat %>%
  dplyr::select(k1,k2,k3,k4,
                a2,a3,a4,a5,a6) 

dfdiff <- data.matrix(sweep(dfalt,2,dfref)) 
```


```{r ghs}

household <- read_dta(file = "../ghs2023/ghs-2023-hhold-v1.dta") 
person <- read_dta(file = "../ghs2023/ghs-2023-person-v1.dta") 

ghs.house <- household %>%
  dplyr::select(uqnr, psu, prov, totmhinc, fin_reqinc, 
                fin_compinc, fin_exp, hholdsz, chld17yr_hh, 
                metro_code, soc_grant_hh, rotation) %>%
  filter(totmhinc != 9999999,
         fin_reqinc != 9999999,
         totmhinc > 0,
         fin_exp !=14) %>%
  transmute(uqnr = as.character(uqnr),
            psu=psu,
            lny = log(totmhinc),
            y.month = totmhinc,
            y2.month = y.month^2,
            lny.sq = lny^2,
            lnminq = log(fin_reqinc),
            minq = fin_reqinc,
            x = as_factor(fin_exp),
            hhsize = hholdsz,
            kids = chld17yr_hh,
            adults = hhsize - kids,
            # This is province and metro combined, 
            # But, I will keep it..
            province = as_factor(prov),
            metro_code = as_factor(metro_code),
            month = as_factor(rotation),
            grants = soc_grant_hh,
            enough_inc = as.factor(as.numeric(fin_compinc <= 3))) %>%
  droplevels()


ghs.person <- person %>%
  dplyr::select(uqnr, personnr, Sex, Population, age, 
                hhc_marital, education, geotype) %>%
  filter(as.numeric(personnr)==1, 
         hhc_marital != 9,
         education != 28,
         education != 29,
         education != 99) %>%  
  transmute(uqnr = as.character(uqnr),
            age = age,
            hhh.male = as_factor(Sex),
            ethnic = as_factor(Population),
            marital = as_factor(hhc_marital),
            settle = factor(geotype, levels = c(1,2,3),
                            labels = c("Urban","Traditional","Farms")),
            education = factor(education, 
                               levels = c(98,0:27),
                               labels=c("none",rep("nqf0",9),"nqf1","nqf2",
                                        "nqf3","nqf4", "nqf1","nqf2","nqf3",
                                       rep("nqf5",3), rep("nqf4",2),"nqf5",
                                       "nqf6", rep("nqf7",2), "nqf8", 
                                       "nqf9", "nqf10"))) %>%
  droplevels() 

ghs2023 <- ghs.house %>%
  full_join(ghs.person, by="uqnr") %>%
  drop_na() %>%
  # could make the number of adults and kids bigger?
  filter(adults > 0, # there are 39 kid-headed households using my definition
         adults <= 6,
         kids <= 4) %>%
  mutate(ao = ordered(adults),
         ko = ordered(kids),
         k0 = 1*(kids==0),
         k1 = 1*(kids==1),
         k2 = 1*(kids==2),
         k3 = 1*(kids==3),
         k4 = 1*(kids==4),
         a1 = 1*(adults==1),
         a2 = 1*(adults==2),
         a3 = 1*(adults==3),
         a4 = 1*(adults==4),
         a5 = 1*(adults==5),
         a6 = 1*(adults==6),
         lny.sq = lny^2,
         age.sq = age^2)  

rm(household, person, ghs.person, ghs.house)

save(ghs2023, file = "../ghs2023/ghs2023-v2.Rdata")
```


\newpage
\pagenumbering{arabic}

# Introduction

The measurement of poverty and inequality is a point of focus for economists and policymakers, especially those based in countries like South Africa, where poverty rates are high and income disparities are stark [@leibbrandtetal2012]. In determining poverty rates, the method employed by Statistics South Africa is money-metric, where they set three primary thresholds: an upper-bound, lower-bound and food poverty line [@StatsSA2021PovertyLines]. These lines are constructed using the cost-of-basic-needs approach, which links welfare to the consumption of goods and services. Money-metric measures, such as these, underscore the statistical measurement of poverty.

However, @Seekings07 and @MethDias04, for example, argue that poverty measures based on income and expenditure ignore the non-income components of living standards. Others argue that money-metric measures ignore fluctuations related to differences in household size and other factors within a household [@poseletal2020; @RavallionLokshin01; @zwane18]. Additionally, money-metric measures may inaccurately assess the degree of poverty, if the income/expenditures used do not align with appropriate aspects of living standards [@poselrogan2016]. Thus, intuitively, it is important to consider individual or household differences in characteristics that are likely to affect needs, e.g., household size and composition, regional cost of living, and subjective perceptions [@Daleyetal20]. @megbowan18 offer some discussion of regional variation within the Eastern Cape of the country, although the focus was not on potential economies of scale that might arise at the level of the household.

An alternative is to employ a subjective income poverty approach, underpinned by the “happiness and economics” literature [@Ravallion14, @Ferreretal03]. This subjective approach uses responses to a minimum income question (MIQ) or similar, assessing individuals’ perceptions of the minimum required (net) income for an acceptable standard of living [@Goedhartetal1977]. Minimum income questions may highlight disparities that objective measures might miss [@RavallionLokshin01]. Furthermore, answers to such questions can be considered across a range of additional factors -- family type, size and geographic location -- that might relate to responses [@bdmnpwz17; @wzbzy20]. The ability to control for additional correlates deepens our understanding of the roles and robustness of various determinants of poverty; it can also help us detect policy focal points [@do13]. 

Although research into subjective well-being is common in South Africa, the estimation of subjective poverty lines is less so. @posel2014 considers individual subjective well-being, while @poselrogan2016 focus on the household. Each of these analyses are founded on ladder-type questions (where respondents rank their living conditions as being representative of very poor to wealthy or they rate their satisfaction with life from very dissatisfied to very satisfied). @poselrogan2019, as far as we know, are the only ones to use MIQ in their analysis, although they used the MIQ to represent income aspirations, i.e., the level of income households aspired to reach. They further examined how reported minimum income correlated with a range of household characteristics, including objective/subjective measures of economic standing and their district's local economic conditions. In a related literature, @koch2022 estimates objective equivalence scales from expenditure shares, while @koch2023 estimates subjective equivalence scales from consumption adequacy questions. Poverty lines could easily be derived from the same methods used to derive equivalence scales; however, neither @koch2022 nor @koch2023 present those estimates. 

Possibly, subjective poverty lines are not commonly estimated, due to  a range of complications/criticisms. A list of which certainly includes reference effects and potential endogeneities related to, for example, actual income and/or household formation. Another concern is the practicality of money-metric measures, when poverty might be better understood as a complex set of capabilities or better measured through multidimensional deprivation indexes. Additional concerns relate to potential difficulties that might be associated with the meaning of  "income" [@pradhanravallion2000] or other cognitive difficulties associated with hypothetical situations; see, for example, @bradbury1989, @melenbergvansoest1996 and @steigeretalproceedings.

In this research, we estimate subjective poverty lines, based upon the minimum income question (MIQ), comparing their implied impact on poverty, relative to money-metric lines that are available. We do so across two surveys from South Africa that were undertaken approximately 10 years apart [@lcs2014; @ghs2023], to see whether there have been any changes in subjective views of poverty over that time period, how much the subjective measures differ from the objective measures, and what those differences imply for poverty rates for different types of households. Our subjective poverty lines are underpinned by ordinary linear and quantile regression analyses that indirectly determine the intersection between actual and required income. It is that intersection that determines the subjective poverty line; see @Goedhartetal1977 or @ravallion2014poor for details. 

**Hmmm, I need to do some more editing from here on down in the intro to tell the story more clearly.**

Despite the existing body of research on poverty in South Africa (Woolard & Leibbrant, 1999; Posel & Rogan, 2014), there are some gaps remaining regarding the role of household dynamics and regional disparities. There are also gaps in what these differences mean in determining a subjective poverty level. Thus, the purpose of this study is to better understand how subjective income levels vary across South African households, using MIQ to capture these differences. This research builds on earlier studies that use the MIQ to explore subjective poverty (Goedhart et al., 1977; Kapteyn et al., 1988). This study explores how a households’ perceived minimum income can vary due to differences in the household size, composition, geographic location and settlement type, amongst other factors. This research aims to provide new insights into the evolving socio-economic landscape of South Africa by using the 2014/2015 living Conditions survey. This work follows a similar method to Wang et al., (2020), in which an OLS regression is computed, and the coefficients are then utilized to estimate subjective poverty lines.

The findings reveal that household composition plays a critical role in shaping income needs, where households with one of more adults have higher subjective poverty levels, and households with three or more adults have lower levels. The results vary with the effect of children within a household, thus further research would be needed to see the effect of children at different ages. The results further highlight significant disparities in subjective poverty thresholds, with households in urban formal areas requiring higher minimum incomes compared to rural and traditional areas.

Anyway, I find three main results and a few smaller points. The first main result is that there is a fairly high minimum income at about R2200-2500, depending on the analysis. This is a one person household value. The second main result is that this value rises slowly, somewhere between R75-125 per additional adult/child in the household. In other words, it does not really depend on household structure. The third main result is that the minimum values have fallen since 2014-15, although not by much. The smaller points -- which may be bigger than I understand at this point -- are at least three-fold. One is that paying out benefits in this way may not make all that much sense, as it might encourage 'overinvestment' in households, possibly via fraudulently reported living arrangements or too many different households. Another is that I may, instead, be picking up a household formation process around some minimum of fixed value; however, the old-age pension is not as large as the baseline value I am finding here. Thus, there is something else? I did a quick NP picture that suggests squaring age is not quite correct, so maybe use age as a 'factor'; however, doing so is not likely to matter enough. A third is that this suggests that a BIG is not a good idea, either, although this point is not so different from the first one. 


# Literature

The minimum income question has a long history and association with poverty, dating back at least to @VANPRAAG1971, although the question has changed slightly since then. @Goedhartetal1977, however, argue that responses to MIQ are positively correlated with own income and family size; therefore, poverty lines should be appropriately adjusted.  @LanjouwRavallion1995 and @v02 uncover similar correlations between MIQ responses, income and household size.  

@kkw88 demonstrate that MIQ can be utilized to evaluate subjective poverty, stressing its ability to capture perceived income adequacy. Similarly, @fv91 argue that subjective data can help understand poverty dynamics across heterogeneous populations, while @rojas2007 finds some non-poor money-metric households to be subjectively impoverished, partly due to differences in household composition and regional cost variations. Thus, it is likely to capture different features of poverty than those that arise from money-metric measures. MIQ may reflect aspirations, rather than needs [@kv78; @RavallionLokshin01, @s83]. Thus, combining subjective poverty with money-metric data may provide a better composite measure of poverty than subjective measures alone [@poselrogan2016].

We are not aware of any research on subjective poverty in South Africa underscored by MIQ. @roberts2025wp uses MIQ to assess the cost of an additional household member, while @poselrogan2019 use MIQ to examine income aspirations. Thus, we offer one of the first analyses of subjective poverty, based on the MIQ in South Africa. However, other subjective measures of economic status do feature. @MollerSaris2001 focus on life satisfaction. On the other hand, @bd04, @poselrogan2016, as well as @repecbila, use subjective poverty -- respondents label themselves as poor, just getting by, or rich, depending on the exact phrasing of the question -- which is categorical. Other categorical measures include multi-step ladders, upon which households place themselves -- on the bottom, top rung, or somewhere in between -- relative to others; @BlaauwPretorius2013, @repecbila and @Kirsten2023 make use of these. For the most part, these analyses examine the determinants of subjective poverty, often comparing substrata of the population to each other finding, amongst others, that black South Africans are subjectively poorer than other population groups. 

<!-- Moller and Saris (2001) used the 1995 Quality of Life Trends study to assess subjective poverty with the aim of examining subjective well-being across racial groups. Their study found that there were significant racial inequalities within the country, with Black South Africans reporting higher levels of subjective poverty compared to other racial groups. Bookwalter and Dalenburg (2004) used the 1994 South African Labour and Development Research Unit (SALDRU) data in their analysis of subjective poverty where they found that transportation and housing significantly influence subjective well-being, especially for rural households Posel & Rogan (2014) used the 2008-2009 LCS where respondents were asked to rate themselves from very poor to wealthy to estimate subjective poverty lines in South Africa. Their findings reveal that a household’s self-assessed level of poverty increases as the size of the household increases. Additionally, they found that larger families benefit from economies of scale and resource sharing and that there can be differences in the cost of living due to some wealthier provinces having higher costs of living. Bila & Biyase (2022) looked at the determinants of subjective poverty using the 2014-2015 LCS, with the aim of  examining the impact of gender, education, marital  status and locality on subjective poverty. They found that factors such as landownership and access to services have an effect on rural households’ subjective poverty. Whereas urban households are more likely to be affected by unemployment and health conditions. In general, they discovered that in South  Africa, variables like income, employment, household size and geographic location play a role in how  poverty is defined. 

Despite these contributions, South African research does not have a focused examination of subjective poverty lines using the MINQ. Most studies rely on alternative subjective measures, leaving gaps in our understanding of how minimum income perceptions vary across household consumptions and regions. This study aims to fill this gap by using the using the 2014-2015 LCS to estimate subjective poverty lines for households based on the MINQ. 
-->

In related literature, @bishopetal2014 and @mysikova2022, amongst others, the MIQ underscores equivalence scales, which enable comparisons across different types of households [@deaton1997book; @f04; @dudel2021assessing; @koch2022]. Allowing for subjectivity recognizes that poverty lines may relate to individual or household perceptions of an acceptable standard of living in any given society [@r92]. Comparability requires assumptions related to utility, such as base independence [@lewbel1989] or equivalence scale exactness [@blackorbydonaldson1993], which are rarely supported empirically [@pendakur1999]. Given these limitations, @blundelllewbel1991 and @blackorbydonaldson1993 suggest focusing attention on minimum utility, where individuals make ends meet. Duality, with respect to utility, implies a minimum level of income corresponding to the minimum level of utility, which underscores 'local comparability' [@grodneretal2022]. 

Local comparability represents a formalization of the intersection approach [@Goedhartetal1977]; the intersection occurs where individuals’ perceptions of their minimum income needs aligns with their actual income. In several studies, the MIQ is used to estimate the income needed for a household of a specific composition to reach what they consider an acceptable quality of living [@bishopetal2014; @mysikova2022]. Although both @bishopetal2014 and @mysikova2022 examine MIQ, they focus on equivalence scales, rather than subjective poverty lines. In practice, equivalence scales are determined, in part, from such lines; thus, implications about poverty lines can be inferred from their research. In both cases, equivalence scales exhibit greater economies of scale than objective scales; thus, the underlying (subjective) poverty lines would have a rather small household sizse gradient. 

In South Africa, the equivalence scale literature is fairly recent [@yatchewsunderi2003; @poseletal2016; @poseletal2020; @koch2022]. Although @poseletal2016 consider hypothetical scales, the rest of this research estimate (semi-)parametric models of food shares (and other consumption good shares), which, via the Engel method can converted into equivalence scales [@deaton1997book].  @koch2023, on the other hand, estimates subjective scales, underpinned by consumption adequacy [@pradhanravallion2000]. As with the subjective literature elsewhere, Koch's subjective scales exhibit extensive economies of scale, suggesting that subjective poverty lines are relatively non-responsive to household size. Below, we examine that gradient in greater detail, using South African survey data from 2014/15 and 2023. 


# Data

We make use of data from two sources. The first is the 2014-2015 Living Conditions Survey (LCS), which was collected by Statistics South Africa [@lcs2014]. The second is the 2023 General Household Survey (GHS), collected by the same [@ghs2023]. The 2014/15 survey offers a baseline; it was used in previous research into both objective and subjective equivalence scales [@koch2022; @koch2023]. The 2023 GHS results are presented partly for comparison and partly for purposes of an update; more recent data might yield different results and conclusions.

Each survey contains data regarding households and the individuals contained therein, although not necessarily in the exact same format. Importantly, each contains the MIQ, as well as information on household structure (number of household members and their ages - we focus our attention on those in the household at least four nights per week), household income, location, the marital status, sex, population group and education level of the household head, and survey participation timing. In particular, we separate the number of children from the number of adults using 18 years of age as the threshold. As previously noted, our variable of interest is the response to MIQ; it is the minimum amount of net income (per month) required for the household to get by. For the analysis, we used its log value. Similarly, we used log monthly income, along with the previously listed variables.

The data files were combined for each survey to compile the preceding information. For both data sets, individuals/households with missing information for the relevant data were removed. The LCS initially contained 23 380 households, while the analysis sub-sample is based on 20 777.^[We removed households with more than 4 children and more than 6 adults. We also removed households that did not offer answers to MIQ or answered 0, and other subjective welfare questions. Furthermore, for some of the household heads, education and marital status were not available.] The GHS initially included 20 927 households, while our analysis sample was reduced to 18 816 after removing missing information.^[As with the LCS, we removed missing information on MIQ, as well as reported 0 values, education and marital status. We also removed households that did not provide information on either income or expenditure.]


# Methods

## Regression

We apply standard methods, assuming a parametric relationship \eqref{eq:nprelation} between reported minimum income $(\underline{Y})$, actual income $(Y)$, household demographic characteristics $(D)$ and other characteristics related to household decisions, such as location, household head marital status and other controls $(Z)$, and unobserved components $u$. We assume log-linearity of incomeand treat the number of adults $(A)$ and children $(K)$ as continuous variables, which yields expression \eqref{eq:continuous}.
\begin{equation}
\label{eq:continuous}
\ln \underline{Y} = \alpha + \beta \ln Y + \phi A_i + \theta K_i + \sum_j \zeta_j Z_j 
\end{equation} 

For sensitivity, we consider a exensions to this relationship. For example, we consider a quadratic income relationship, as in \eqref{eq:quad}. 
\begin{equation}
\label{eq:quad}
\ln \underline{Y} = \alpha + \beta \ln Y + \gamma \left( \ln Y \right)^2 + \phi A_i + \theta K_i + \sum_j \zeta_j Z_j 
\end{equation}
Furthermore, since the preceding expressions assume that each additional adult and/or child increases the minimum income at the same rate, we follow @koch2022 and @koch2023. Specifically, we create a dummy variable representation of household structure, as in \eqref{eq:linindex}. Specifically, we define $a_{ia} = \mathbf{1}(A_i=a)$, with the kids $(\kappa)$ dummy variables similarly defined. An extension with a quadratic relationship in actual income is also estimated.
\begin{equation}
\label{eq:linindex}
\ln \underline{Y} = \alpha + \beta \ln Y + \sum_a \delta_a a_{ia} + \sum_k \psi_k \kappa_{ik} + \sum_j \zeta_j Z_j 
\end{equation}
Finally, we estimate a quantile regression, based on \eqref{eq:continuous}. 

The subjective poverty lines arising from this analysis are determined by the model parameters, the implication of which is exogeneity. In other words, household structure and income are not correlated with unobserved information, conditional on the controls included in the model - a strong assumption. Amongst other issues, previous literature has suggested that: household size depends on the gender of the household head [@poseletal2016]; household arrangements depend on migration [@wittenberg2017decomposing] and access to income, and by implication, the source of that income [@hamoudithomas2014]; that income could also be measured with error [@burgerersawp]. Furthermore, the economics/demography literature is replete with models suggesting that fertility is endogenous, and, therefore, so is the number of (biological) children in the household [@tshiswaka2017contraceptive]. 

Addressing these potential threats to identification is problematic. Identification would be assured, if appropriate confounders can be included in the analysis or, if such confounders are not observable, instruments are available. Our analysis includes income, as well as a numerical count of grant recipients in the household to capture income and variation in income source, the latter of which is likely strongly correlated with household structure. To deal with measurement error in income, one could follow control function or heteroskedasticity instrumentation [@Lewbel2012] methods. The method outlined by @dong2010 and applied by koch2022, requires a continuous variable with a greater range than the endogenous regressor. For the LCS data, expenditure could be used; however, for the GHS data, expenditure is only available across 12 categories -- it is not continuous and certainly does not cover a wider range than reported income. Thus, we instrument, but do not report estimates, via heteroskedasticity to address endogeneity concerns.^[Full results are available upon request. The effect of the endogeneity control is discussed in the manuscript.] 

## Subjective poverty lines

Subjective poverty lines are described as fixed points [@Goedhartetal1977], where $\ln \underline{Y} = f(\ln \underline{Y}, D, Z)$. Under linearity, that fixed point occurs at the intercept, adjusted for the regression slope; it also differs depending on whether we assume constant marginal required income "costs" for children and adults or if we allow for a quadratic income relationship.^[With a quadratic term in the regression, the fixed point is determined by the solution to the quadratic formula -- we did not uncover any complex roots in our analysis.] Treating adults and kids as continuous variables, as in \eqref{eq:continuous}, the (log) subjective poverty line is defined by \eqref{eq:linear-spl}. 
\begin{equation}
\label{eq:linear-spl}
\ln \underline{Y}_i =  \frac{\alpha + \phi A_i + \theta K_i + \sum_j \zeta_j Z_j }{1-\beta}
\end{equation}

In other words, estimates yield constant percentage changes; the percentage change in required income for an additional adult is $\phi/(1-\beta)$, while the percentage change per child is $\theta/(1-\beta)$.^[The partial derivative of $\ln \underline{Y}_i$ with respect to $A_i$ in \eqref{eq:linear-spl} is constant $(\phi)$. In models where squared income is included, the underlying calculations are more complicated because the quadratic formula is used to determine the poverty line. In other words, $\ln \underline{Y} = (2a)^{-1}\times (-b \pm \sqrt{b^2 - 4ac})$, where $a=\gamma$, $b=1-\beta$ and $c= \alpha + \phi A + \theta K$. There are two roots; one yields required income levels approximate five times its mean value in the two surveys, while the other yields levels relatively close to the mean values in the surveys; we choose the smaller of these, because it is more representative of the data.] As reported below, we find support for this modelling assumption, and, therefore, we do not derive poverty lines underpinned by non-constant percentage changes per child that would be implied by estimates from \eqref{eq:linindex} or \eqref{eq:quad}. For the quantile models, equation \eqref{eq:linear-spl} remains relevant; however, because estimates are quantile-dependent, so are the resulting poverty lines.

<!--On the other hand, if indicator functions are used for each child and each adult, the subjective poverty line is determined by \eqref{eq:linear-spl-dummy}.
\begin{equation}
\label{eq:linear-spl-dummy}
\underline{Y} =  \exp \left( \frac{\alpha + + \sum_a \delta_a a_{ia} + \sum_k \psi_k \kappa_{ik} + \sum_j \zeta_j Z_j }{1-\beta} \right)
\end{equation}
For reporting, we net out all of the $Z$ factors; they are included in the regression, but are not included in the calculation of subjective poverty. However, it is possible to calculate different subjective poverty lines for different regions of the country, or other subgroups by altering the calculation structure.

For the general equation, we will apply simulation methods, searching for the value of $\ln \underline{Y} = f(\ln \underline Y, D, Z)$, conditional on $D$ and $Z$. 

Rearranging to find the intersection - goedhart - yields the subjective poverty line, as a function of the demographic and other characteristics \eqref{eq:spl}.

\begin{equation}
\label{eq:spl}
\underline{Y} =  \exp \left( \frac{\alpha + \sum_j \delta_j D_j + \sum_j \zeta_j Z_j }{1-\beta} \right)
\end{equation}


From these subjective poverty lines, marginal child and adult costs can be derived for each additional household member $(h \in \{a,k\})$, where $a$ and $k$ refer to adult and child, respectively, while $\underline{Y}^*$ is the reference household, which we will define as having one adult and zero children. **Is this independent of the number of adults and children already in the house? As before, we can turn off the "other" variables?** 

\begin{equation}
\label{eq:margcost}
M(h) = \frac{\underline{Y}(h) - \underline{Y}(h-1) }{\underline{Y}^*}
\end{equation}


The linear model specified yields marginal costs that are partially independent of the underlying size of the household, and, therefore, may not be appropriate. *Are they partially independent? Not really, because of the exponential functions... The SPLs are partially independent, though.* Specifically, it is possible the that the marginal cost of a first child is larger/smaller in a household with two adults than in a household with one adult. Therefore, we also estimate the nonparametric model in \eqref{eq:nprelation}. To capture the intersection, we apply numeric methods, because the inverse of an unspecified function cannot be determined. 

*Option 1:* First, we fix $D$ and $Z$ to create a data subsample. We use the fixed values of $D$ and $Z$, as well as the observed $\ln Y$ values to predict $\hat{f}$ for all households in the subset. We then choose the $\ln Y$ that is closest to the fitted value, as the subjective poverty line for that household type. *Worry:* this value may not be all that "close". 

*Option 2:* First, we fix $D$ and $Z$. Second, we simulate $\ln Y$ across a wide range. We use the simulated data to predict $\hat{f}$ for all households in the subset. We then choose the simulated $\ln Y$ that is closest to the fitted value, as the subjective poverty line for that household type. *Worry:* this value may not match what households say they spend?

\begin{equation}
\label{eq:nprelation2}
\ln \underline{Y} = \hat{f}(\ln Y,\tilde{D},\tilde{Z})
\end{equation}

-->


# Results


## Descriptive statistics

Descriptive statistics are available in the appendix; see Tables \@ref(tab:dstat) and \@ref(tab:dstat-ghs). The data is available for all households, and is further separated by an indicator of whether the household's minimum required income is larger than its actual income, i.e., they have enough (or too little). The data suggests a slight increase (over time) in the proportion of households with too little, an increase in the level of education of the household head, as well as increases in both income and reported minimum required income (in logs). However, those increases are not large. According to the data (not weighted to the population), minimum required income increased by 0.28 log points, while actual income increased by 0.24. In other words, average minimum required income increased by 0.28%, which is a bit more than average income, which increased by 0.24% over the 9 years between surveys.

## Regression results

**I dropped these figures - Might want to bring the Loess back?**
We begin by illustrating the nonparametric relationship between income and minimum required (using logs) in Figures \@ref(fig:lcs-loess-plot) and \@ref(fig:ghs-loess-plot). Each figure contains two curves: one underpinned by a Loess regression plot, which does not account for additional controls, while the other is derived from a fully nonparametric estimate of the relationship that includes the same controls as in equation \eqref{eq:continuous}. 


In these figures, we see some evidence that the additional controls affect the relationship, although the slopes of both curves are fairly similar in each figure. Both figures also include the 45$^\circ$ line. Comparing across the two figures, the intersection of the curves with that 45$^\circ$ line - which underpins the estimation of poverty lines - occurs at lower values in 2014-15 relative to 2023. Below, we see whether that change in intersection affects the subjective poverty lines.

```{r model-formulas}

ysmooth <- formula(minq ~ y.month + adults + kids +  age + age.sq +
                    hhh.male + ethnic + province + settle +
                    marital + education + month + grants)

sdummy <- formula(minq ~ y.month + k1 + k2 + k3 + k4 + 
                    a2 + a3 + a4 + a5 + a6 +  age + age.sq +
                    hhh.male + ethnic + province + settle +
                    marital + education + month + grants)

quad <- formula(minq ~ y.month + y2.month + adults + kids +  
                  age + age.sq +hhh.male + ethnic + province + 
                  settle + marital + education + month + grants)

qdummy <- formula(minq ~ y.month + y2.month + k1 + k2 + k3 + k4 + 
                    a2 + a3 + a4 + a5 + a6 +  age + age.sq +
                    hhh.male + ethnic + province + settle +
                    marital + education + month + grants)

```


```{r linear-models, dependson="lcs; model-formulas"}

## dummy rows for squared term..
ddr1 <- tibble(n="lny.sq",results = NA)
ddr2 <- tibble(n="lny.sq",results = NA)
ddr <- rbind(ddr1, ddr2)

base.data <- lcs2014 

lineary_smooth <- lm(ysmooth,
                     data=base.data)
lineary_smooth_tab <- ctab(lineary_smooth, 
                           cluster = lcs2014$psu)[1:8,c(1,3)]
lysmooth_tab <- rbind(lineary_smooth_tab[1:4,],
                      ddr,
                      lineary_smooth_tab[5:8,])

lcs_ly_smooth_tab <- ctab(lineary_smooth, 
                           cluster = lcs2014$psu)

lineary_dummies <- lm(sdummy,
                     data=base.data)
lineary_dummies_tab <- ctab(lineary_dummies, 
                           cluster = lcs2014$psu)[1:22,3]
lydum_tab <- rbind(lineary_dummies_tab[1:4,],
                     ddr[,2],
                     lineary_dummies_tab[5:22,])
lcs_ly_dummies_tab <- ctab(lineary_dummies, 
                           cluster = lcs2014$psu)

quadraticy_smooth <- lm(quad,
                       data=base.data)
quadraticy_smooth_tab <- ctab(quadraticy_smooth, 
                           cluster = lcs2014$psu)[1:10,3] 
lcs_qy_smooth_tab <- ctab(quadraticy_smooth, 
                           cluster = lcs2014$psu)

quadraticy_dummies <- lm(qdummy,
                         data=base.data)
quadraticy_dummies_tab <- ctab(quadraticy_dummies, 
                           cluster = lcs2014$psu)[1:24,3]
lcs_qy_dummies_tab <- ctab(quadraticy_dummies, 
                           cluster = lcs2014$psu)

# hypothesis tests...
vcov_cluster_ldum <- vcovCL(lineary_dummies, cluster = ~ psu)
vcov_cluster_qdum <- vcovCL(quadraticy_dummies, cluster = ~ psu)

# Joint test of coefficients k1..k4 and a2..a6
kids_ldum <- linearHypothesis(lineary_dummies,
                 c("4*k1 = k4", 
                   "3*k1 = k3",
                   "2*k1 = k2"),
                 vcov = vcov_cluster_ldum,
                 test = "F")

kids_qdum <- linearHypothesis(quadraticy_dummies,
                 c("4*k1 = k4", 
                   "3*k1 = k3",
                   "2*k1 = k2"),
                 vcov = vcov_cluster_qdum,
                 test = "F")

adults_ldum <- linearHypothesis(lineary_dummies,
                 c("3*a2 = a6",
                   "2.5*a2 = a5",
                   "2*a2 = a4", 
                   "1.5*a2 = a3"),
                 vcov = vcov_cluster_ldum,
                 test = "F")

adults_qdum <- linearHypothesis(quadraticy_dummies,
                 c("3*a2 = a6",
                   "2.5*a2 = a5",
                   "2*a2 = a4", 
                   "1.5*a2 = a3"),
                 vcov = vcov_cluster_qdum,
                 test = "F")

all_ldum <- linearHypothesis(lineary_dummies,
                 c("4*k1 = k4", 
                   "3*k1 = k3",
                   "2*k1 = k2",
                   "3*a2 = a6",
                   "2.5*a2 = a5",
                   "2*a2 = a4", 
                   "1.5*a2 = a3"),
                 vcov = vcov_cluster_ldum,
                 test = "F")

all_qdum <- linearHypothesis(quadraticy_dummies,
                 c("4*k1 = k4", 
                   "3*k1 = k3",
                   "2*k1 = k2",
                   "3*a2 = a6",
                   "2.5*a2 = a5",
                   "2*a2 = a4", 
                   "1.5*a2 = a3"),
                 vcov = vcov_cluster_qdum,
                 test = "F")


```

```{r linear-models-ghs, dependson="ghs;model-formulas"}
## dummy rows for squared term..
ddr1 <- tibble(n="y2.month",results = NA)
ddr2 <- tibble(n="y2.month",results = NA)
ddr <- rbind(ddr1, ddr2)

base.data <- ghs2023 

lineary_smooth <- lm(ysmooth,
                     data=base.data)
lineary_smooth_ghs <- ctab(lineary_smooth, 
                           cluster = ghs2023$psu)[1:8,c(1,3)]
lysmooth_ghs <- rbind(lineary_smooth_ghs[1:4,],
                      ddr,
                      lineary_smooth_ghs[5:8,])
ghs_ly_smooth_tab <- ctab(lineary_smooth, 
                           cluster = ghs2023$psu)

lineary_dummies <- lm(sdummy,
                      data=base.data)
lineary_dummies_ghs <- ctab(lineary_dummies, 
                           cluster = ghs2023$psu)[1:22,3]
lydum_ghs <- rbind(lineary_dummies_ghs[1:4,],
                   ddr[,2],
                   lineary_dummies_ghs[5:22,])
ghs_ly_dummies_tab <- ctab(lineary_dummies, 
                           cluster = ghs2023$psu)

quadraticy_smooth <- lm(quad,
                        data=base.data)
quadraticy_smooth_ghs <- ctab(quadraticy_smooth, 
                           cluster = ghs2023$psu)[1:10,3] 
ghs_qy_smooth_tab <- ctab(quadraticy_smooth, 
                           cluster = ghs2023$psu)

quadraticy_dummies <- lm(qdummy,
                         data=base.data)
quadraticy_dummies_ghs <- ctab(quadraticy_dummies, 
                           cluster = ghs2023$psu)[1:24,3]
ghs_qy_dummies_tab <- ctab(quadraticy_dummies, 
                           cluster = ghs2023$psu)

# hypothesis tests...
vcov_cluster_ldum <- vcovCL(lineary_dummies, cluster = ~ psu)
vcov_cluster_qdum <- vcovCL(quadraticy_dummies, cluster = ~ psu)

# Joint test of coefficients k1..k4 and a2..a6
kids_ldum_ghs <- linearHypothesis(lineary_dummies,
                 c("4*k1 = k4", 
                   "3*k1 = k3",
                   "2*k1 = k2"),
                 vcov = vcov_cluster_ldum,
                 test = "F")

kids_qdum_ghs <- linearHypothesis(quadraticy_dummies,
                 c("4*k1 = k4", 
                   "3*k1 = k3",
                   "2*k1 = k2"),
                 vcov = vcov_cluster_qdum,
                 test = "F")

adults_ldum_ghs <- linearHypothesis(lineary_dummies,
                 c("3*a2 = a6",
                   "2.5*a2 = a5",
                   "2*a2 = a4", 
                   "1.5*a2 = a3"),
                 vcov = vcov_cluster_ldum,
                 test = "F")

adults_qdum_ghs <- linearHypothesis(quadraticy_dummies,
                 c("3*a2 = a6",
                   "2.5*a2 = a5",
                   "2*a2 = a4", 
                   "1.5*a2 = a3"),
                 vcov = vcov_cluster_qdum,
                 test = "F")


all_ldum <- linearHypothesis(lineary_dummies,
                 c("4*k1 = k4", 
                   "3*k1 = k3",
                   "2*k1 = k2",
                   "3*a2 = a6",
                   "2.5*a2 = a5",
                   "2*a2 = a4", 
                   "1.5*a2 = a3"),
                 vcov = vcov_cluster_ldum,
                 test = "F")

all_qdum <- linearHypothesis(quadraticy_dummies,
                 c("4*k1 = k4", 
                   "3*k1 = k3",
                   "2*k1 = k2",
                   "3*a2 = a6",
                   "2.5*a2 = a5",
                   "2*a2 = a4", 
                   "1.5*a2 = a3"),
                 vcov = vcov_cluster_qdum,
                 test = "F")
```


```{r basemodel, dependson="lcs;ghs"}
lcs_data <- lcs2014 

ghs_data <- ghs2023 


lcs_model <- lm(ysmooth,
                data=lcs_data)

ghs_model <- lm(ysmooth,
                data=ghs_data)


lcs_kids <- coef(lcs_model)["kids"]
ghs_kids <- coef(ghs_model)["kids"]

lcs_adults <- coef(lcs_model)["adults"]
ghs_adults <- coef(ghs_model)["adults"]

lcs_inc <- coef(lcs_model)["y.month"]
ghs_inc <- coef(ghs_model)["y.month"]
```


```{r exog-quantiles, dependson="model-formulas"}

taus <- seq(0.01,0.95,0.01)

# Estimate quantile regressions for each tau
# smooth adults/kids
lcs_fit <- rq(ysmooth, 
              data = lcs_data, tau = taus)

lcs_tidy_fit <- tidy(lcs_fit, conf.int = FALSE, conf.level = 0.95)


ghs_fit <- rq(ysmooth, 
              data = ghs_data, tau = taus)
#summary(fit, se = "boot")
#summary(fit)[c(1,20)]

ghs_tidy_fit <- tidy(ghs_fit, conf.int = FALSE, conf.level = 0.95)
```


## Subjective poverty

Before calculating the subjective poverty lines, we present the main household structure estimates from the linear and quadratic models; see Table \@ref(tab:linear-kids-adults-table). Four important take-aways can be gleaned from this table. The first is that constant coefficients for each adult and child is a reasonable approximation across both surveys.^[We test this with a joint hypothesis test accounting for data clustering. For all models in both years, the constant hypothesis is not rejected for adults. Only for the linear model in 2014 is the joint test of constant parameters rejected at a 0.05 level of confidence; it is not rejected for the the three remaining. When we jointly test for constancy for adults and children, it is rejected for for both data sources assuming a 0.05 level of confidence. Technically, this is a test whether (for example) the estimate for four children is four times that of one child, the estimate for four adults is two times the estimate for two adults, and so on.] Second, required minimum income is increasing in the number of adults and children, while the increase per child is estimated to be larger than for an adult. Thus, required income increases with household size, and moreso for children than adults. The third is that required income per child and adult is larger in 2023 than it was in 2014/15. Each of these three suggest increasing subjective poverty lines for household size and over time. However, the fourth observation is that the intercept is lower in 2023 than in 2014 which lowers the reference level for subjective poverty. After combining the third and fourth observations, whether the lines will be higher or lower in 2023 is an empirical question, and, therefore, we will compute the lines for both surveys for comparison. See Table \@ref{tab:spl-table} for those computations.

```{r linear-kids-adults-table, dependson="linear-models; linear-models-ghs", results = "asis"}

# Will build simple tables for the adults and kids
# components of the models
# Goal is just to show if this really matters..
# Effect sizes...

smooth.tab.names <- c("Intercept","","Income", "",
                      "Squared Income","",
                      "Adults in hh", "", 
                      "Children in hh","")
smooth.tab <- tibble(rnames = smooth.tab.names, 
                     ly = lysmooth_tab$results, 
                     qy = quadraticy_smooth_tab$results,
                     ly23 = lysmooth_ghs$results, 
                     qy23 = quadraticy_smooth_ghs$results)

dummies.tab.names <- c("Intercept","","Income", "",
                      "Squared Income","",
                      "One child","","Two children","",
                      "Three children","", "Four children","",
                       "Two adults","", "Three adults","",
                      "Four adults","", "Five adults","",
                      "Six adults","")
dummies.tab <- tibble(rnames = dummies.tab.names, 
                      ly = lydum_tab$results, 
                      qy = quadraticy_dummies_tab$results, 
                      ly23 = lydum_ghs$results, 
                      qy23 = quadraticy_dummies_ghs$results)


results.tab <- rbind(smooth.tab, dummies.tab)

kable(results.tab, format = "latex", align='lrrrr',
      row.names = F,
      booktabs=TRUE, escape=FALSE, longtable=TRUE,
      linesep="",
      caption="Effect size estimates for adults and children on (log) reported minimum household income from the Living Conditions Survey 2014-15 and General Household Survey 2023",
      col.names=c("Composition","Linear","Quadratic","Linear","Quadratic")) %>%
  add_header_above(c(" "=1, "Living Conditions" = 2, "General Household" = 2)) %>%
  pack_rows("Adults and children as continuous variables", 1, 10) %>%
  row_spec(10, hline_after = TRUE) %>%
  pack_rows("Adults and children as categorical variables", 11, 34) %>%
  #row_spec(34, hline_after = TRUE) %>%
  kable_styling(latex_options = c("striped", "hold_position", position="center")) %>%
  footnote(general = "Estimated coefficients across household types. Reported estimates limited to children and adults in the household. Models included the log of household income (Linear) as well as the matching square (Quadratic), and the total number of grants received in the household, as well as household head age, its square, gender, and population group. Models also included province, survey month, head education, marital status and settlement-type fixed effects.", escape=FALSE, general_title="",threeparttable=TRUE) 

```

**Is this really correct?** Before doing so, we are able to calculate the (percentage change) in required minimum income per adult and per child, for each of the survey years. Due to the fact that we cannot reject the null hypothesis that estimates are constant across adults and children, we limit our presentation our model suggests that the percentage increase in required minimum income per adult is constant, as is the percentage increase in required minimum income per child, although there is a difference between the adult and child percentage. 

## Subjectively poor vs NT objectively poor?


```{r lineary-spl-smooth, dependson="lcs-sub; lcs; model-formulas"}

base.data <- lcs2014 

model <- lm(ysmooth,
            data=base.data)

b <- coef(model)[1:4] # does not count non-income and non-adult/child vars.
b1 <- b[3:4]          # just the kids and adult bit
denom <- 1-b[2]

dfdiff <- akmat %>% dplyr::select(adults, kids) %>%
  as.matrix()

spl.base <-   (b[1] + (dfdiff %*% b1)) * (1/denom) 

spl.lin.yall <- akmat %>%
  add_column(spl.linear = as.integer(spl.base)) 

spl.lin.yall.table <- spl.lin.yall %>%
  rename("spl" = "spl.linear") 

```


```{r quady-spl-smooth, dependson="lcs-sub; lcs; model-formulas"}

base.data <- lcs2014 

model <- lm(quad,
            data=base.data)

b <- coef(model)[1:5] # does not count non-income and non-adult/child vars.
b1 <- b[4:5]          # just the kids and adult bit


dfdiff <- akmat %>% dplyr::select(adults,kids) %>%
  as.matrix()

# This calculates for all household types at once... but no real roots?
c <- (b[1] + (dfdiff %*% b1))
bb <- b[2] - 1
a <- b[3]

discriminant <- (bb^2) - (4*a*c)

# How to choose?
root1 <- (-bb + sqrt(discriminant))*(1/(2*a))
root2 <- (-bb - sqrt(discriminant))*(1/(2*a))

# do not understand why not working?
spl.base <-   root2 

spl.quad.yall <- akmat %>%
  dplyr::select(adults,kids) %>%
  add_column(spl.quad = as.integer(spl.base))

spl.quad.yall.table <- spl.quad.yall %>%
  rename("spl" = "spl.quad") 
```



```{r lineary-spl-smooth-ghs, dependson="lcs-sub; ghs; model-formulas"}

base.data <- ghs2023 

model <- lm(ysmooth,
            data=base.data)

b <- coef(model)[1:4] # does not count non-income and non-adult/child vars.
b1 <- b[3:4]          # just the kids and adult bit
denom <- 1-b[2]

dfdiff <- akmat %>% dplyr::select(adults,kids) %>% 
  as.matrix()

spl.base <-   (b[1] + (dfdiff %*% b1)) * (1/denom) 

spl.lin.yall.2023 <- akmat %>%
  dplyr::select(adults,kids) %>%
  add_column(spl.linear = as.integer(spl.base)) 

spl.lin.yall.table.2023 <- spl.lin.yall.2023 %>%
  rename("spl" = "spl.linear") 

```

```{r quady-spl-smooth-ghs, dependson="lcs-sub; ghs; model-formulas"}

base.data <- ghs2023 

model <- lm(quad,
            data=base.data)

b <- coef(model)[1:5] # does not count non-income and non-adult/child vars.
b1 <- b[4:5]          # just the kids and adult bit


dfdiff <- akmat %>% dplyr::select(adults,kids) %>% 
  as.matrix()

# This calculates for all household types at once... but no real roots?
c <- (b[1] + (dfdiff %*% b1))
bb <- b[2] - 1
a <- b[3]

discriminant <- (bb^2) - (4*a*c)

# How to choose?
root1 <- (-bb + sqrt(discriminant))*(1/(2*a))
root2 <- (-bb - sqrt(discriminant))*(1/(2*a))

# do not understand why not working?
spl.base <-   root2 

spl.quad.yall.2023 <- akmat %>%
  dplyr::select(adults,kids) %>%
  add_column(spl.quad = as.integer(spl.base))

spl.quad.yall.table.2023 <- spl.quad.yall.2023 %>%
  rename("spl" = "spl.quad") 
```


```{r poor-data, dependson="lcs; lineary-spl-smooth; quady-spl-smooth", results="asis"}


# This builds out a simple table...
# How do we want to use this?
poor.data <- left_join(lcs2014, spl.lin.yall,
                       by = c("adults","kids")) %>%
  left_join(spl.quad.yall, by = c("adults","kids")) %>%
  mutate(hhsize = adults + kids,
         lbpoverty = hhsize * 647,
         ubpoverty = hhsize * 992,
         y = y.month,
         x = x.month) %>%
  group_by(adults,kids) %>%
  summarise(own.subj.poor = round(100*sum(lny < lnminq)/n(),2),
            lin.subj.poor = round(100*sum(y < spl.linear)/n(),2),
            quad.subj.poor = round(100*sum(y < spl.quad)/n(),2),
            obj.poor.lb = round(100*sum(y < lbpoverty)/n(),2),
            obj.poor.ub = round(100*sum(y < ubpoverty)/n(),2)) %>%
  ungroup() 

  #
  
kable(poor.data, format = "latex", align='rrrrrrr',
      row.names = F,
      booktabs=TRUE, escape=FALSE, longtable=TRUE,
      linesep="",
      caption="Precentage of poor households by household structure type based on subjective and objective poverty lines from the Living Conditions Survey 2014-15",
      col.names=c("Adults","Kids", "Own Value","Linear","Quadratic","Lower","Upper")) %>%
  add_header_above(c(" "=2, "Subjective Measures"=3, "Objective Measures" = 2)) %>%
  kable_styling(latex_options = c("striped", "hold_position", position="center")) %>%
  footnote(general = "Estimated poverty percentages based on subjective poverty lines underscored by linear and quadratic estimates of minimum income levels compared to lower (ZAR 647 per capita in 2014) and upper bound poverty (ZAR 992 per capita) lines from national treasury. Percentages not weighted to the population. Own value represents the percentage of people whose reported income is exceeded by their reported minimum required income.", escape=FALSE, general_title="",threeparttable=TRUE) 


```


```{r poor-data-ghs, dependson="ghs; lineary-spl-smooth-ghs; quady-spl-smooth-ghs", results="asis"}

# This builds out a simple table...
# How do we want to use this?
poor.data <- left_join(ghs2023, spl.lin.yall.2023,
                       by = c("adults","kids")) %>%
  left_join(spl.quad.yall.2023, by = c("adults","kids")) %>%
  mutate(hhsize = adults + kids,
         lbpoverty = hhsize * 1058,
         ubpoverty = hhsize * 1558,
         y = y.month) %>%
  group_by(adults,kids) %>%
  summarise(own.subj.poor = round(100*sum(lny < lnminq)/n(),2),
            lin.subj.poor = round(100*sum(y < spl.linear)/n(),2),
            quad.subj.poor = round(100*sum(y < spl.quad)/n(),2),
            obj.poor.lb = round(100*sum(y < lbpoverty)/n(),2),
            obj.poor.ub = round(100*sum(y < ubpoverty)/n(),2)) %>%
  ungroup() 

kable(poor.data, format = "latex", align='rrrrrrr',
      row.names = F,
      booktabs=TRUE, escape=FALSE, longtable=TRUE,
      linesep="",
      caption="Precentage of poor households by household structure type based on subjective and objective poverty lines from the General Household Survey 2023",
      col.names=c("Adults","Kids", "Own Value","Linear","Quadratic","Lower","Upper")) %>%
  add_header_above(c(" "=2, "Subjective Measures"=3, "Objective Measures" = 2)) %>%
  kable_styling(latex_options = c("striped", "hold_position", position="center")) %>%
  footnote(general = "Estimated poverty percentages based on subjective poverty lines underscored by linear and quadratic estimates of minimum income levels compared to lower (ZAR 1058 per capita in 2023) and upper bound poverty (ZAR 1558 per capita) lines from national treasury. Percentages not weighted to the population. Own value represents the percentage of people whose reported income is exceeded by their reported minimum required income.", escape=FALSE, general_title="",threeparttable=TRUE) 


```

# Sensitivity

```{r lcs_hetiv, dependson="lcs; model-formulas"}

lcs_data <- lcs2014 

lcs_base <- lm(ysmooth,
               data=lcs_data)
# Cluster-robust vcov
vcov_cluster <- vcovCL(lcs_base, cluster = lcs_data$psu)
# Coefficient test with clustered SEs
ct <- coeftest(lcs_base, vcov = vcov_cluster)
# Convert to tidy tibble
tidy_base <- tidy(ct)

theta = tidy_base$estimate[4] 
#ifelse(tidy_base$p.value[4] > 0.05,
#               0, tidy_base$estimate[4])
phi = tidy_base$estimate[3]
#ifelse(tidy_base$p.value[3] > 0.05,
#               0, tidy_base$estimate[3])
one_beta = 1-tidy_base$estimate[2]
#1-ifelse(tidy_base$p.value[2] > 0.05,
#                  0, tidy_base$estimate[2])              

k0 = theta/one_beta
a0 = phi/one_beta

lcs_kidiv <- hetErrorsIV(minq ~ y.month + adults +  age + 
                           age.sq + hhh.male + ethnic + province +
                           settle + marital + education + month +
                           grants + kids | kids | 
                           IIV(age, grants, y.month),
                         data=lcs_data, 
                         verbose = FALSE)
# Cluster-robust vcov
vcov_cluster <- vcovCL(lcs_kidiv, cluster = lcs_data$psu)
# Coefficient test with clustered SEs
ct <- coeftest(lcs_kidiv, vcov = vcov_cluster)
# Convert to tidy tibble
tidy_kids <- tidy(ct)

kk = which(tidy_kids$term=="kids")
aa = which(tidy_kids$term=="adults")
yy = which(tidy_kids$term=="y.month")

theta = tidy_kids$estimate[kk]
#ifelse(tidy_kids$p.value[kk] > 0.05,
#               0, tidy_kids$estimate[kk])
phi = tidy_kids$estimate[aa]
#ifelse(tidy_kids$p.value[aa] > 0.05,
 #              0, tidy_kids$estimate[aa])
one_beta = 1-tidy_kids$estimate[yy]
#ifelse(tidy_kids$p.value[yy] > 0.05,
#                  0, tidy_kids$estimate[yy])              

k1 = theta/one_beta
a1 = phi/one_beta

lcs_adiv <- hetErrorsIV(minq ~ y.month + kids +  age + 
                           age.sq + hhh.male + ethnic + province +
                           settle + marital + education + month +
                           grants + adults | adults | 
                           IIV(age, grants, y.month),
                         data=lcs_data, 
                         verbose = FALSE)
# Cluster-robust vcov
vcov_cluster <- vcovCL(lcs_adiv, cluster = lcs_data$psu)
# Coefficient test with clustered SEs
ct <- coeftest(lcs_adiv, vcov = vcov_cluster)
# Convert to tidy tibble
tidy_adults <- tidy(ct)

kk = which(tidy_adults$term=="kids")
aa = which(tidy_adults$term=="adults")
yy = which(tidy_adults$term=="y.month")

theta = tidy_adults$estimate[kk]
#ifelse(tidy_kids$p.value[kk] > 0.05,
#               0, tidy_kids$estimate[kk])
phi = tidy_adults$estimate[aa]
#ifelse(tidy_kids$p.value[aa] > 0.05,
 #              0, tidy_kids$estimate[aa])
one_beta = 1-tidy_adults$estimate[yy]
#ifelse(tidy_kids$p.value[yy] > 0.05,
#                  0, tidy_kids$estimate[yy])               

k2 = theta/one_beta
a2 = phi/one_beta

lcs_lnyiv <- hetErrorsIV(lnminq ~ adults + kids +  age + 
                           age.sq + hhh.male + ethnic + province +
                           settle + marital + education + month +
                           grants + y.month | y.month | 
                           IIV(age, grants) | x.month,
                         data=lcs_data, 
                         verbose = FALSE)

# Cluster-robust vcov
vcov_cluster <- vcovCL(lcs_lnyiv, cluster = lcs_data$psu)
# Coefficient test with clustered SEs
ct <- coeftest(lcs_lnyiv, vcov = vcov_cluster)
# Convert to tidy tibble
tidy_lny <- tidy(ct)

kk = which(tidy_lny$term=="kids")
aa = which(tidy_lny$term=="adults")
yy = which(tidy_lny$term=="lny")

theta = tidy_lny$estimate[kk]
#ifelse(tidy_kids$p.value[kk] > 0.05,
#               0, tidy_kids$estimate[kk])
phi = tidy_lny$estimate[aa]
#ifelse(tidy_kids$p.value[aa] > 0.05,
 #              0, tidy_kids$estimate[aa])
one_beta = 1-tidy_lny$estimate[yy]
#ifelse(tidy_kids$p.value[yy] > 0.05,
#                  0, tidy_kids$estimate[yy])                

k3 = theta/one_beta
a3 = phi/one_beta

a = cbind(a0,a1,a2,a3)
k = cbind(k0,k1,k2,k3)

lcs_tab = rbind(a,k)
```

```{r ghs_hetiv, dependson="ghs; model-formulas"}

ghs_data <- ghs2023 %>%
  # categorical "x" values, not really useful as CF
  mutate(lnx = as.numeric(x)) 
#%>%
 # filter(lnx < 13)

ghs_base <- lm(ysmooth,
               data=ghs_data)
# Cluster-robust vcov
vcov_cluster <- vcovCL(ghs_base, cluster = ghs_data$psu)
# Coefficient test with clustered SEs
ct <- coeftest(ghs_base, vcov = vcov_cluster)
# Convert to tidy tibble
tidy_base <- tidy(ct)

theta = tidy_base$estimate[4]
#ifelse(tidy_base$p.value[4] > 0.05,
#               0, tidy_base$estimate[4])
phi = tidy_base$estimate[3]
#ifelse(tidy_base$p.value[3] > 0.05,
#               0, tidy_base$estimate[3])
one_beta = 1-tidy_base$estimate[2]
#ifelse(tidy_base$p.value[2] > 0.05,
#                  0, tidy_base$estimate[2])              

k0 = theta/one_beta
a0 = phi/one_beta

ghs_kidiv <- hetErrorsIV(minq ~ y.month + adults +  age + 
                           age.sq + hhh.male + ethnic + province +
                           settle + marital + education + month +
                           grants + kids | kids | 
                           IIV(age, grants, y.month),
                         data=ghs_data, 
                         verbose = FALSE)
# Cluster-robust vcov
vcov_cluster <- vcovCL(ghs_kidiv, cluster = ghs_data$psu)
# Coefficient test with clustered SEs
ct <- coeftest(ghs_kidiv, vcov = vcov_cluster)
# Convert to tidy tibble
tidy_kids <- tidy(ct)

kk = which(tidy_kids$term=="kids")
aa = which(tidy_kids$term=="adults")
yy = which(tidy_kids$term=="y.month")

theta = tidy_kids$estimate[kk]
#ifelse(tidy_kids$p.value[kk] > 0.05,
#               0, tidy_kids$estimate[kk])
phi = tidy_kids$estimate[aa]
#ifelse(tidy_kids$p.value[aa] > 0.05,
#               0, tidy_kids$estimate[aa])
one_beta = 1-tidy_kids$estimate[yy]
#ifelse(tidy_kids$p.value[yy] > 0.05,
#                  0, tidy_kids$estimate[yy])              

k1 = theta/one_beta
a1 = phi/one_beta

ghs_adiv <- hetErrorsIV(minq ~ y.month  + kids +  age + 
                           age.sq + hhh.male + ethnic + province +
                           settle + marital + education + month +
                           grants + adults | adults | 
                           IIV(age, grants, y.month),
                         data=ghs_data, 
                         verbose = FALSE)
# Cluster-robust vcov
vcov_cluster <- vcovCL(ghs_adiv, cluster = ghs_data$psu)
# Coefficient test with clustered SEs
ct <- coeftest(ghs_adiv, vcov = vcov_cluster)
# Convert to tidy tibble
tidy_adults <- tidy(ct)

kk = which(tidy_adults$term=="kids")
aa = which(tidy_adults$term=="adults")
yy = which(tidy_adults$term=="y.month")

theta = tidy_adults$estimate[kk]
#ifelse(tidy_adults$p.value[kk] > 0.05,
#               0, tidy_adults$estimate[kk])
phi = tidy_adults$estimate[aa]
#ifelse(tidy_adults$p.value[aa] > 0.05,
#               0, tidy_adults$estimate[aa])
one_beta = 1-tidy_adults$estimate[yy]
#ifelse(tidy_adults$p.value[yy] > 0.05,
#                  0, tidy_adults$estimate[yy])              

k2 = theta/one_beta
a2 = phi/one_beta

ghs_lnyiv <- hetErrorsIV(lnminq ~  adults + kids +  age + 
                           age.sq + hhh.male + ethnic + province +
                           settle + marital + education + month +
                           grants + y.month | y.month | 
                           IIV(age, grants, x) ,
                         data=ghs_data, 
                         verbose = FALSE)

# Cluster-robust vcov
vcov_cluster <- vcovCL(ghs_lnyiv, cluster = ghs_data$psu)
# Coefficient test with clustered SEs
ct <- coeftest(ghs_lnyiv, vcov = vcov_cluster)
# Convert to tidy tibble
tidy_lny <- tidy(ct)

kk = which(tidy_lny$term=="kids")
aa = which(tidy_lny$term=="adults")
yy = which(tidy_lny$term=="lny")

theta = tidy_lny$estimate[kk]
#ifelse(tidy_lny$p.value[kk] > 0.05,
#               0, tidy_lny$estimate[kk])
phi = tidy_lny$estimate[aa]
#ifelse(tidy_lny$p.value[aa] > 0.05,
#               0, tidy_lny$estimate[aa])
one_beta = 1-tidy_lny$estimate[yy]
#ifelse(tidy_lny$p.value[yy] > 0.05,
 #                 0, tidy_lny$estimate[yy])              

k3 = theta/one_beta
a3 = phi/one_beta

a = cbind(a0,a1,a2,a3)
k = cbind(k0,k1,k2,k3)

ghs_tab = rbind(a,k)
```

For sensitivity analysis, we focused our attention on two main issues. The first relates to potential endogeneity. The second relates to functional form. To consider the first, we applied heteroskedasticity IV estimates [@Lewbel2012]. For the second, we considered a range of additional estimates. We included a quadratic (log) income term; we treated each number of adults and children as separate dummies; we estimated a quantile regression; and, we estimated a nonparametric regression. 

## Potential endogeneity

For the analysis, we are concerned with three potential sources of endogeneity. There are potential unobserved factors that correlate with household income and there are potential unobserved determinants of both the number of children and the number of adults in the household. Given three potential sources of endogeneity, it would be ideal to incorporate three instruments. Uncovering one instrument is difficult -- finding three is unrealistic. Therefore, we undertake a triangulation exercise, examining the results that would arise under the assumption that only one of the three variables is endogenous at any one time.

As noted earlier, the literature has suggested that household size is partly affected by grant access - a variable we incorporated into the analysis; in our view, it is not likely to meet the exclusion restriction, since grants are a form of income, and are, therefore, likely to correlate directly with required income. Within South Africa, grants are strongly linked to age. However, age is expected to directly influence minimum income requirements through its proximate relationship with life experience. Although using such variables directly is problematic, we use their demeaned values along with that of log income, to capture the heteroskedasticity and identify the model parameters.

We further use those parameters to estimate the percentage change in minimum required income arising from the model. These results are reported in Table \@ref(tab:endog-tab). The table contains four rows, two each for the two different surveys, and, within a survey, one for the child 'effect' and one for the 'adult' effect. The discussion related to equation \eqref{eq:linear-spl}, the derivative of which defines the values presented in the table, and are the percentage change in minimum required income per adult (or child), which is assumed to be constant, given the model estimated.

```{r endog-tab, dependson="lcs_hetiv;ghs_hetiv", results="asis"}

results.tab = rbind(lcs_tab,ghs_tab)
rownames(results.tab) = c("Adult percentage change",
                          "Child percentage change",
                          "Adult change",
                          "Child change")

kable(results.tab, format = "latex", align='rrrr',
      row.names = T, digits = 4,
      booktabs=TRUE, escape=FALSE, longtable=FALSE,
      linesep="",
      caption="Estimated percent change in required minimum income per adult/child with and without endogeneity correction",
      col.names=c("Uncorrected",  "Child Endog", "Adult Endog", "Income Endog")) %>%
#  add_header_above(c(" "=1, "Living Conditions" = 2, "General Household" = 2)) %>%
  pack_rows("Living Conditions Survey 2014/15", 1, 2) %>%
  row_spec(2, hline_after = TRUE) %>%
  pack_rows("General Household Survey 2023", 3,4) %>%
  #row_spec(34, hline_after = TRUE) %>%
  kable_styling(latex_options = c("striped", "hold_position", position="center")) %>%
  footnote(general = "Estimated percentage changes in required minimum income at the household level per adult or child, depending on whether none (uncorrected), adults (adult endog), children (child endog) or income (income endog) was treated as a potentially endogenous variable. Parameter estimates were clustered. Endogeneity corrections based on heteroskedastic IV, where the age of the household head, (log) household income - except when income was treated as endogenous - and the number of grants in the household were demeaned for the IV estimate. When income was treated as endogenous, only age and the number of grants were used, while (log) expenditure was treated as an external instrument.", escape=FALSE, general_title="",threeparttable=TRUE) 
```

The first column of Table \@ref(tab:endog-tab) represents the estimate from an uncorrected model -- previously discussed. The second columen assumes that the number of adults in the household is endogenous, correcting for that using the @Lewbel2012 heteroskedasticity instrument method; the third coloumn assumes that it is, instead, the number of children that are endogenous and uses the same estimator. The last column reports results based on the assumption that income is the endogenous variable. 

The results in the table suggest a wide range of results -- with the uncorrected results closer to the middle of that range. Uncorrected, as previously reported, implies that minimum increases by approximately 5-6% per child and adult in 2014/15. Applying heteroskedasticity IV corrections led to adult percentage changes just below 0 (-1.4%) to approximately 11%, and chlid percentage changes between -4.4 and 6.6%. This (marginal) percentage change was generally larger for the 2023 data. For adults the increase was approximately 9.8%; for children, the increase was closer to 15.8%. After applying the @Lewbel2012 estimator to the 2023 data, the adult percentage change ranged from 0 to 12.6%, while the child percentage change ranged from 0 to 21.3%. 




## Quantile regression

In an additional follow-up, we estimated a series of quantile models. Importantly, quantile regression is designed to model both location and scale. Such a model inherently captures non-linearities in the data, possibly arising from heteroskedasticity (ANGRIST-PISHKE??). In Figures \@ref(fig:exog-plots-kids) to \@ref(fig:exog-plots-income), we illustrate the regression parameters for children, adults and log income, respectively; we include the bootstrapped 95% confidence interval around those estimates in each figure. We also illustrate the mean estimate, which arises from the uncorrected ordinary least squares regression. Each Figure contains two panels, one for the Living Conditions Survey data; the other for the General Household Survey data.

```{r exog-plots-kids, dependson="exog-quantiles;basemodel", fig.cap = "Children quantile plots", fig.subcap = c("Living Conditions Survey","General Household Survey"), out.width=c("48%","48%")}

# lcs
lcs_tidy_fit %>%
  filter(term == "kids") %>%
ggplot(aes(x = tau, y = estimate)) +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), 
              fill = "skyblue", alpha = 0.4) +
  geom_line(color = "blue", linewidth = 1.2) +
  geom_hline(yintercept = lcs_kids, color = "red", 
             linetype = "dashed") +
  labs(
    title = "Quantile Regression Coefficients with 95% CI",
    x = "Quantile (tau)", 
    y = "Child estimate"
  ) +
  theme_minimal(base_size = 12)

#plot_drinker <- 
ghs_tidy_fit %>%
  filter(term == "kids") %>%
ggplot(aes(x = tau, y = estimate)) +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), 
              fill = "skyblue", alpha = 0.4) +
  geom_line(color = "blue", linewidth = 1.2) +
  geom_hline(yintercept = ghs_kids, color = "red", 
             linetype = "dashed") +
  labs(
    title = "Quantile Regression Coefficients with 95% CI",
    x = "Quantile (tau)", 
    y = "Child estimate"
  ) +
  theme_minimal(base_size = 12)


```

As can be implied from the figures, there are nonlinearities in the underlying relationship between (log) required minimum income, the number of children, the number of adults, and actual (log) household income. Furthermore, the nonlinear relationship is not constant over time, although the adult-quantile gradient is reasonably similar over the two surveys. The child-quantile gradient switches sign, from negative to positive, between 2014 and 2023, while the (log) income-quantile gradient changes from an inverse$-U$ in 2014 to an inverse$-J$ (it mostly negative) in 2023. 

```{r exog-plots-adults, dependson="exog-quantiles;basemodel", fig.cap = "Adult quantile plots", fig.subcap = c("Living Conditions Survey","General Household Survey"), out.width=c("48%","48%")}

# lcs
lcs_tidy_fit %>%
  filter(term == "adults") %>%
ggplot(aes(x = tau, y = estimate)) +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), 
              fill = "skyblue", alpha = 0.4) +
  geom_line(color = "blue", linewidth = 1.2) +
  geom_hline(yintercept = lcs_adults, color = "red", 
             linetype = "dashed") +
  labs(
    title = "Quantile Regression Coefficients with 95% CI",
    x = "Quantile (tau)", 
    y = "Child estimate"
  ) +
  theme_minimal(base_size = 12)

#plot_drinker <- 
ghs_tidy_fit %>%
  filter(term == "adults") %>%
ggplot(aes(x = tau, y = estimate)) +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), 
              fill = "skyblue", alpha = 0.4) +
  geom_line(color = "blue", linewidth = 1.2) +
  geom_hline(yintercept = ghs_adults, color = "red", 
             linetype = "dashed") +
  labs(
    title = "Quantile Regression Coefficients with 95% CI",
    x = "Quantile (tau)", 
    y = "Adult estimate"
  ) +
  theme_minimal(base_size = 12)


```

Because the parameters in these models can be used to estimate the underlying percentage changes in minimum required income per adult and per child, but at different quantiles of minimum required income, we do just that. The results are reported in Table \@ref(tab:quant-tab). Again, the results relate directly to equation \eqref{eq:linear-spl}. As we have noted, the derivative of the equation defines the values presented in the table. They represent the percentage change in minimum required income per adult (or child) at that particular quantile.

```{r exog-plots-income, dependson="exog-quantiles;basemodel", fig.cap = "Income quantile plots", fig.subcap = c("Living Conditions Survey","General Household Survey"), out.width=c("48%","48%")}

# lcs
lcs_tidy_fit %>%
  filter(term == "lny") %>%
ggplot(aes(x = tau, y = estimate)) +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), 
              fill = "skyblue", alpha = 0.4) +
  geom_line(color = "blue", linewidth = 1.2) +
  geom_hline(yintercept = lcs_inc, color = "red", 
             linetype = "dashed") +
  labs(
    title = "Quantile Regression Coefficients with 95% CI",
    x = "Quantile (tau)", 
    y = "Income estimate"
  ) +
  theme_minimal(base_size = 12)

#plot_drinker <- 
ghs_tidy_fit %>%
  filter(term == "lny") %>%
ggplot(aes(x = tau, y = estimate)) +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), 
              fill = "skyblue", alpha = 0.4) +
  geom_line(color = "blue", linewidth = 1.2) +
  geom_hline(yintercept = ghs_inc, color = "red", 
             linetype = "dashed") +
  labs(
    title = "Quantile Regression Coefficients with 95% CI",
    x = "Quantile (tau)", 
    y = "Income estimate"
  ) +
  theme_minimal(base_size = 12)


```

```{r quant-tab, dependson="exog-quantiles", results="asis"}

coef_subset <- lcs_tidy_fit %>%
  filter(term %in%  c("adults","kids","lny"), 
         tau %in% c(0.2, 0.4, 0.6, 0.8)) %>%
  dplyr::select(tau,term,estimate) %>%
  pivot_wider(
    names_from = term,
    values_from = estimate
  )

lcs_change <- coef_subset %>%
  transmute(#tau,
            dlny_da = adults/(1-lny),
            dlny_dk = kids/(1-lny)) %>%
  t()

coef_subset <- ghs_tidy_fit %>%
  filter(term %in%  c("adults","kids","lny"), 
         tau %in% c(0.2, 0.4, 0.6, 0.8)) %>%
  dplyr::select(tau,term,estimate) %>%
  pivot_wider(
    names_from = term,
    values_from = estimate
  )

ghs_change <- coef_subset %>%
  transmute(#tau,
            dlny_da = adults/(1-lny),
            dlny_dk = kids/(1-lny)) %>%
  t()

change_tab <- rbind(lcs_change,
                    ghs_change)

rownames(change_tab) = c("Adult percentage change",
                          "Child percentage change",
                          "Adult change",
                          "Child change")

kable(change_tab, format = "latex", align='rrrr',
      row.names = T, digits = 4,
      booktabs=TRUE, escape=FALSE, longtable=FALSE,
      linesep="",
      caption="Estimated percent change in required minimum income per adult/child with and without endogeneity correction",
      col.names=c("$\\tau$ = 0.2",  "$\\tau$ = 0.4", "$\\tau$ = 0.6", "$\\tau$ = 0.8")) %>%
#  add_header_above(c(" "=1, "Living Conditions" = 2, "General Household" = 2)) %>%
  pack_rows("Living Conditions Survey 2014/15", 1, 2) %>%
  row_spec(2, hline_after = TRUE) %>%
  pack_rows("General Household Survey 2023", 3,4) %>%
  #row_spec(34, hline_after = TRUE) %>%
  kable_styling(latex_options = c("striped", "hold_position", position="center")) %>%
  footnote(general = "Estimated percentage changes in required minimum income at the household level per adult or child across quantiles of required minimum income; only a subset of quantiles are reported in the table.", escape=FALSE, general_title="",threeparttable=TRUE) 
  
```

The estimates suggest that the percentage change per adult/child is higher in 2023 than it was in 2014/15. The range of estimates for children is from about 5-8% in 2014/15, given the chosen quantiles,  but from 14% to 17% in 2023. For adults, the ranges are similarly different. In 2014/15 the adult range is 2-10%; it is 3-13% in 2023. Furthermore, the estimated percentage changes are generally rising with the quantile, the exception being children in 2014/15, found to yield relatively smaller percentage increases at higher quantiles of minimum required income. In other words, the non-linearities uncovered in the parameter estimates feed into non-constant change estimates, mostly increasing percentage changes in required mininum incomes.


\newpage
\singlespacing
# References {-}
<div id="refs"></div>

\doublespacing

\newpage
\appendix

\setcounter{figure}{0}
\renewcommand\thefigure{\Alph{section}.\arabic{figure}} 
  
\setcounter{table}{0}
\renewcommand\thetable{\Alph{section}.\arabic{table}} 

\setcounter{equation}{0}
\renewcommand\theequation{\Alph{section}.\arabic{equation}}

# Descriptive Statistics


```{r dstat, dependson="lcs", results="asis"}

# create a factor to split on for comparison
# For fun, I dropped equality, but did not lose many 
# --  9 have the exact same...
All <- lcs2014 %>%
  mutate(lnylnminq = as_factor(
    case_when(
     lny < lnminq ~ "Too little",
     lny >= lnminq ~ "Enough"
  )),
  adults = as.numeric(adults),
  kids = as.numeric(kids)) %>%
  droplevels()


our.sum.description <- list(
  "Population Group" = 
    list("African" = ~ only_perc(ethnic=="African/Black"),
         "Mixed" = ~ only_perc(ethnic=="Coloured"),
         "Asian" = ~ only_perc(ethnic=="Indian/Asian"),
         "White" = ~ only_perc(ethnic=="White")),
  "Marital Status" = 
    list("Marrried" = ~ only_perc(marital=="Married"),
         "Partners" = ~ only_perc(marital=="Living together as married partners"),
         "Never married" = ~ only_perc(marital=="Never married"),
         "Widowed" = ~ only_perc(marital=="Widower/Widow"),
         "Separate" = ~ only_perc(marital=="Separated"),
         "Divorced" = ~ only_perc(marital=="Divorced")),
  "Education" = 
    list("No schooling" = ~ only_perc(education=="none"),
         "Some schooling" = ~ only_perc(education=="nqf0"),
         "Completed grade 9" = ~ only_perc(education=="nqf1"),
         "Completed grade 10" = ~ only_perc(education=="nqf2"),
         "Completed grade 11" = ~ only_perc(education=="nqf3"),
         "Completed grade 12" = ~ only_perc(education=="nqf4"),
         "First year university" = ~ only_perc(education=="nqf5"),
         "Second year university" = ~ only_perc(education=="nqf6"),
         "Completed university" = ~ only_perc(education=="nqf7"),
         "Completed honours" = ~ only_perc(education=="nqf8"),
         "Further postgraduate" = ~ only_perc(education=="nqf9-10")),
  "Residence" = 
    list("Urban formal" = ~ only_perc(settle=="Urban Formal"),
         "Urban informal" = ~ only_perc(settle=="Urban Informal"),
         "Traditional area" = ~ only_perc(settle=="Traditional Area"),
         "Rural formal" = ~ only_perc(settle=="Rural Formal")),
  "Province" = 
    list("Western Cape" = ~ only_perc(province=="Western Cape"),
         "Eastern Cape" = ~ only_perc(province=="Eastern Cape"),
         "Northern Cape" = ~ only_perc(province=="Northern Cape"),
         "Free State" = ~ only_perc(province=="Free State"),
         "KwaZulu-Natal" = ~ only_perc(province=="Kwazulu Natal"),
         "North West" = ~ only_perc(province=="North West"),
         "Gauteng" = ~ only_perc(province=="Gauteng"),
         "Mpumalanga" = ~ only_perc(province=="Mpumalanga"),
         "Limpopo" = ~ only_perc(province=="Limpopo")),
  "Household Head Age" = 
    list("mean (sd)" = ~ qwraps2::mean_sd(age, denote_sd="paren")),
  "Household Composition" = 
    list("Children: mean (sd)" = ~ qwraps2::mean_sd(kids, denote_sd="paren"),
         "Adults: mean (sd)" = ~ qwraps2::mean_sd(adults, denote_sd="paren")),
 "Log Income and Expenditure" = 
   list("Expenditure: mean (sd)" = ~ qwraps2::mean_sd(lnx, denote_sd="paren"),
        "Income: mean (sd)" = ~ qwraps2::mean_sd(lny, denote_sd="paren"),
        "Minimum income: mean (sd)" = ~ qwraps2::mean_sd(lnminq, denote_sd="paren"))
)


our.sum.adequate <- qwraps2::summary_table(dplyr::group_by(All,lnylnminq), our.sum.description)
our.sum.total <- qwraps2::summary_table(All,our.sum.description)

our.sum.table <- cbind(our.sum.total, our.sum.adequate)

print(our.sum.table, vline="", align="l|rrr",longtable=TRUE,booktabs=T,linesep="",
      caption="Summary statistics of household or household head overall and by income adequacy. \\footnotesize{Note: Categorical variables are presented as the percent of observations in each category within each column. For continuous variables, the mean is presented with its standard deviation, separated by $\\pm$. All represents the entire database, Enough represents household's whose reported minimum income is not less than their actual, and Too little represents those whose reported minimum income exceeds their actual.}",
      rtitle= "\\bf{Adequate income}"
      #cnames = c("\\multicolumn{3}{c}{Food Adequacy}")
      )


```

```{r dstat-ghs, dependson="ghs", results="asis"}

# create a factor to split on for comparison
# For fun, I dropped equality, but did not lose many 
# --  9 have the exact same...
All <- ghs2023 %>%
  mutate(lnylnminq = as_factor(
    case_when(
      lny < lnminq ~ "Too little",
      lny >= lnminq ~ "Enough"
    )),
    adults = as.numeric(adults),
    kids = as.numeric(kids)) %>%
  droplevels()


our.sum.description <- list(
  "Population Group" = 
    list("African" = ~ only_perc(ethnic=="1. African/Black"),
         "Mixed" = ~ only_perc(ethnic=="2. Coloured"),
         "Asian" = ~ only_perc(ethnic=="3. Indian/Asian"),
         "White" = ~ only_perc(ethnic=="4. White")),
  "Marital Status" = 
    list("Marrried" = ~ only_perc(marital=="1. Legally married"),
         "Partners" = ~ only_perc(marital=="2. Living together like husband and wife/partners"),
         "Never married" = ~ only_perc(marital=="7. Single and have never been married/never lived together as husband/wife before" |
                                         marital == "6. Single, but have lived together with someone as husband/wife before"),
         "Widowed" = ~ only_perc(marital=="5. Widowed"),
         "Separate" = ~ only_perc(marital=="4. Separated, but still legally married"),
         "Divorced" = ~ only_perc(marital=="3. Divorced")),
  "Education" = 
    list("No schooling" = ~ only_perc(education=="none"),
         "Some schooling" = ~ only_perc(education=="nqf0"),
         "Completed grade 9" = ~ only_perc(education=="nqf1"),
         "Completed grade 10" = ~ only_perc(education=="nqf2"),
         "Completed grade 11" = ~ only_perc(education=="nqf3"),
         "Completed grade 12" = ~ only_perc(education=="nqf4"),
         "First year university" = ~ only_perc(education=="nqf5"),
         "Second year university" = ~ only_perc(education=="nqf6"),
         "Completed university" = ~ only_perc(education=="nqf7"),
         "Completed honours" = ~ only_perc(education=="nqf8"),
         "M Degree" = ~ only_perc(education=="nqf9"),
         "PhD Degree" = ~ only_perc(education=="nqf10")),
  "Residence" = 
    list("Urban" = ~ only_perc(settle=="Urban"),
         "Traditional" = ~ only_perc(settle=="Traditional"),
         "Farms" = ~ only_perc(settle=="Farms")),
  "Province" = 
    list("Western Cape" = ~ only_perc(province=="1. Western Cape"),
         "Eastern Cape" = ~ only_perc(province=="2. Eastern Cape"),
         "Northern Cape" = ~ only_perc(province=="3. Northern Cape"),
         "Free State" = ~ only_perc(province=="4. Free State"),
         "KwaZulu-Natal" = ~ only_perc(province=="5. Kwazulu Natal"),
         "North West" = ~ only_perc(province=="6. North West"),
         "Gauteng" = ~ only_perc(province=="7. Gauteng"),
         "Mpumalanga" = ~ only_perc(province=="8. Mpumalanga"),
         "Limpopo" = ~ only_perc(province=="9. Limpopo")),
  "Household Head Age" = 
    list("mean (sd)" = ~ qwraps2::mean_sd(age, denote_sd="paren")),
  "Household Composition" = 
    list("Children: mean (sd)" = ~ qwraps2::mean_sd(kids, denote_sd="paren"),
         "Adults: mean (sd)" = ~ qwraps2::mean_sd(adults, denote_sd="paren")),
  "Log Income and Expenditure" = 
    list(#"Expenditure: mean (sd)" = ~ qwraps2::mean_sd(lnx, denote_sd="paren"),
         "Income: mean (sd)" = ~ qwraps2::mean_sd(lny, denote_sd="paren"),
         "Minimum income: mean (sd)" = ~ qwraps2::mean_sd(lnminq, denote_sd="paren"))
)


our.sum.adequate <- qwraps2::summary_table(dplyr::group_by(All,lnylnminq), our.sum.description)
our.sum.total <- qwraps2::summary_table(All,our.sum.description)

our.sum.table <- cbind(our.sum.total, our.sum.adequate)

print(our.sum.table, vline="", align="l|rrr",longtable=TRUE,booktabs=T,linesep="",
      caption="Summary statistics of household or household head overall and by income adequacy. \\footnotesize{Note: Categorical variables are presented as the percent of observations in each category within each column. For continuous variables, the mean is presented with its standard deviation, separated by $\\pm$. All represents the entire database, Enough represents household's whose reported minimum income is not less than their actual, and Too little represents those whose reported minimum income exceeds their actual.}",
      rtitle= "\\bf{Adequate income}"
      #cnames = c("\\multicolumn{3}{c}{Food Adequacy}")
)


```

\setcounter{figure}{0}
\renewcommand\thefigure{\Alph{section}.\arabic{figure}} 
  
\setcounter{table}{0}
\renewcommand\thetable{\Alph{section}.\arabic{table}} 

\setcounter{equation}{0}
\renewcommand\theequation{\Alph{section}.\arabic{equation}}

# Subjective poverty line estimates miniumum income questions

```{r spl-table, dependson="lineary-spl-smooth; quady-spl-smooth; lineary-spl-smooth-ghs; quady-spl-smooth-ghs; some-functions", results="asis", size = "footnotesize"}

spl.tab <- cbind(spl.lin.yall.table, spl.quad.yall.table[,3], 
                 spl.lin.yall.table.2023[,3], spl.quad.yall.table.2023[,3]) 
                 #round( zed[,3:6], digits=0))

kable(spl.tab, format = "latex", align='cccccc',
      row.names = F,
      booktabs=TRUE, escape=FALSE, longtable=TRUE,
      linesep="",
      caption="Estimate of subjective poverty lines based on minimum household income, underpinned by linear regression model using data from the Living Conditions Survey 2014-15 and the General Household Survey 2023",
      col.names=c("Adults","Kids", "Linear", "Qadratic","Linear", "Qadratic")) %>%
  add_header_above(c(" "=2, "Living Conditions"=2, "General Household" = 2)) %>%
  kable_styling(latex_options = c("striped", "hold_position", position="center")) %>%
  footnote(general = "Estimated poverty lines by household type (adults and kids), netting out effects related to location, and other household head controls.", escape=FALSE, general_title="",threeparttable=TRUE) 
```

\setcounter{figure}{0}
\renewcommand\thefigure{\Alph{section}.\arabic{figure}} 
  
\setcounter{table}{0}
\renewcommand\thetable{\Alph{section}.\arabic{table}} 

\setcounter{equation}{0}
\renewcommand\theequation{\Alph{section}.\arabic{equation}}

# Linear estimates

```{r smooth-table, dependson="linear-models; linear-models-ghs", results = "asis"}

## dummy rows for squared term..
ddr1 <- c(n="lny.sq",params="b",results = NA)
ddr2 <- c(n="lny.sq",params="s",results = NA)
ddr <- rbind(ddr1, ddr2)

# lcs linear y and smooth a/k
#lcs_ly_smooth_tab 
lcsly <- rbind(lcs_ly_smooth_tab[1:4,],
              ddr,
              lcs_ly_smooth_tab[5:98,])
lcsly_tab <- lcsly[c(3:22,99:100),]

# lcs quadratic y and smooth a/k
#lcs_qy_smooth_tab 
lcsqy_tab <- lcs_qy_smooth_tab[c(3:22,99:100),]

# ghs linear y and smooth a/k
#ghs_ly_smooth_tab 
ghsly <- rbind(ghs_ly_smooth_tab[1:4,],
              ddr,
              ghs_ly_smooth_tab[5:82,])
ghsly_tab <- ghsly[c(3:22,83:84),]

# lcs quadratic y and smooth a/k
#lcs_qy_smooth_tab 
ghsqy_tab <- ghs_qy_smooth_tab[c(3:22,83:84),]

smooth.tab.names <- c("Income","","Squared log income", "",
        "Adults in HH","", "Kids in HH","",
        "Age of HH Head","", "Squared age of head","",
        "Female head","", "Coloured head","",
        "Asian head","","White head","",
        "Grants in HH","")
smooth.tab <- tibble(rnames = smooth.tab.names, 
                     ly = lcsly_tab$results, 
                     qy = lcsqy_tab$results,
                     ly23 = ghsly_tab$results, 
                     qy23 = ghsqy_tab$results)


kable(smooth.tab, format = "latex", align='lrrrr',
      row.names = F,
      booktabs=TRUE, escape=FALSE, longtable=TRUE,
      linesep="",
      caption="Effect size estimates for a subsete of controls for (log) reported minimum household income from the Living Conditions Survey 2014-15 and General Household Survey 2023",
      col.names=c("Composition","Linear","Quadratic","Linear","Quadratic")) %>%
  add_header_above(c(" "=1, "Living Conditions" = 2, "General Household" = 2)) %>%
  #pack_rows("Adults and children as continuous variables", 1, 4) %>%
  #row_spec(4, hline_after = TRUE) %>%
  #pack_rows("Adults and children as categorical variables", 5, 22) %>%
  #row_spec(22, hline_after = TRUE) %>%
  kable_styling(latex_options = c("striped", "hold_position", position="center")) %>%
  footnote(general = "Estimated coefficients across surveys.  Models also included province, survey month, head education, marital status and settlement-type fixed effects.", escape=FALSE, general_title="",threeparttable=TRUE) 

```

```{r dummies-table, dependson="linear-models; linear-models-ghs", results = "asis"}

## dummy rows for squared term..
ddr1 <- c(n="lny.sq",params="b",results = NA)
ddr2 <- c(n="lny.sq",params="s",results = NA)
ddr <- rbind(ddr1, ddr2)

# lcs linear y and dummies a/k
#lcs_ly_dummies_tab 
lcsly <- rbind(lcs_ly_dummies_tab[1:4,],
              ddr,
              lcs_ly_dummies_tab[5:112,])
lcsly_tab <- lcsly[c(3:36,113:114),]

# lcs quadratic y and dummies a/k
#lcs_qy_dummies_tab 
lcsqy_tab <- lcs_qy_dummies_tab[c(3:36,113:114),]

# ghs linear y and dummies a/k
#ghs_ly_dummies_tab 
ghsly <- rbind(ghs_ly_dummies_tab[1:4,],
              ddr,
              ghs_ly_dummies_tab[5:96,])
ghsly_tab <- ghsly[c(3:36,97:98),,]

# lcs quadratic y and dummies a/k
#lcs_qy_dummies_tab 
ghsqy_tab <- ghs_qy_dummies_tab[c(3:36,97:98),]

dummies.tab.names <- c("Income","","Squared log income", "",
                       "One child","","Two children","",
                       "Three children","","Four children","",
                       "Two adults","", "Three adults","",
                       "Four adults","","Five adults","",
                       "Six adults","",
                       "Age of HH Head","", "Squared age of head","",
                       "Female head","", "Coloured head","",
                       "Asian head","","White head","",
                       "Grants in HH","")
dummies.tab <- tibble(rnames = dummies.tab.names, 
                      ly = lcsly_tab$results, 
                      qy = lcsqy_tab$results,
                      ly23 = ghsly_tab$results, 
                      qy23 = ghsqy_tab$results)

kable(dummies.tab, format = "latex", align='lrrrr',
      row.names = F,
      booktabs=TRUE, escape=FALSE, longtable=TRUE,
      linesep="",
      caption="Effect size estimates for a subset of controls on (log) reported minimum household income from the Living Conditions Survey 2014-15 and General Household Survey 2023",
      col.names=c("Composition","Linear","Quadratic","Linear","Quadratic")) %>%
  add_header_above(c(" "=1, "Living Conditions" = 2, "General Household" = 2)) %>%
  #pack_rows("Adults and children as continuous variables", 1, 4) %>%
  #row_spec(4, hline_after = TRUE) %>%
  #pack_rows("Adults and children as categorical variables", 5, 22) %>%
  #row_spec(22, hline_after = TRUE) %>%
  kable_styling(latex_options = c("striped", "hold_position", position="center")) %>%
  footnote(general = "Estimated coefficients across surveys.  Models also included province, survey month, head education, marital status and settlement-type fixed effects.", escape=FALSE, general_title="",threeparttable=TRUE) 

```



